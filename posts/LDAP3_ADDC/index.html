<!DOCTYPE html><html lang="en" data-mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="A Hands-On Guide to Active Directory Enumeration and Modification with ldap3" /><meta property="og:locale" content="en" /><meta name="description" content="Overview :" /><meta property="og:description" content="Overview :" /><link rel="canonical" href="/posts/LDAP3_ADDC/" /><meta property="og:url" content="/posts/LDAP3_ADDC/" /><meta property="og:site_name" content="Mostafa Toumi" /><meta property="og:image" content="/assets/img/favicons/HackTheBox/ADDC-LDAP3/ADDC-LDAP3.png" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2024-01-14T07:00:00+01:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="/assets/img/favicons/HackTheBox/ADDC-LDAP3/ADDC-LDAP3.png" /><meta property="twitter:title" content="A Hands-On Guide to Active Directory Enumeration and Modification with ldap3" /><meta name="twitter:site" content="@EmSec0" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2024-01-14T07:00:00+01:00","datePublished":"2024-01-14T07:00:00+01:00","description":"Overview :","headline":"A Hands-On Guide to Active Directory Enumeration and Modification with ldap3","image":"/assets/img/favicons/HackTheBox/ADDC-LDAP3/ADDC-LDAP3.png","mainEntityOfPage":{"@type":"WebPage","@id":"/posts/LDAP3_ADDC/"},"url":"/posts/LDAP3_ADDC/"}</script><title>A Hands-On Guide to Active Directory Enumeration and Modification with ldap3 | Mostafa Toumi</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Mostafa Toumi"><meta name="application-name" content="Mostafa Toumi"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.20.1/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="https://raw.githubusercontent.com/Mostafatoumi/mostafatoumi.github.io/main/assets/img/favicons/HackTheBox/emsec_1.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title"> <a href="/">Mostafa Toumi</a></div><div class="site-subtitle font-italic">Computer Networking Specialist | Penetration Tester | CTF Player</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/Mostafatoumi" aria-label="github" target="_blank" rel="noopener noreferrer"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/EmSec0" aria-label="twitter" target="_blank" rel="noopener noreferrer"> <i class="fa-brands fa-x-twitter"></i> </a> <a href="javascript:location.href = 'mailto:' + ['Mostafatoumi0','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="https://www.hackthebox.com/home/users/profile/962022" aria-label="hackthebox" target="_blank" rel="noopener noreferrer"> <i class="fas fa-cube"></i> </a> <a href="https://www.linkedin.com/in/mostafatoumi/" aria-label="linkedin" target="_blank" rel="noopener noreferrer"> <i class="fab fa-linkedin"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>A Hands-On Guide to Active Directory Enumeration and Modification with ldap3</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>A Hands-On Guide to Active Directory Enumeration and Modification with ldap3</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1705212000" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Jan 14, 2024 </em> </span><div class="mt-3 mb-3"> <a href="/assets/img/favicons/HackTheBox/ADDC-LDAP3/ADDC-LDAP3.png" class="popup img-link preview-img shimmer"><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1200 630'%3E%3C/svg%3E" data-src="/assets/img/favicons/HackTheBox/ADDC-LDAP3/ADDC-LDAP3.png" alt="Preview Image" width="1200" height="630" class="lazyload" data-proofer-ignore></a></div><div class="d-flex justify-content-between"> <span> By <em> <a href="https://twitter.com/EmSec0">Mostafa Toumi</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="3709 words"> <em>20 min</em> read</span></div></div></div><div class="post-content"><h2 id="overview-"><span class="mr-2">Overview :</span><a href="#overview-" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>In this blog, we’ll embark on a journey into the world of LDAP (Lightweight Directory Access Protocol) and Active Directory. But here’s the twist – no pre-existing tools like <code class="language-plaintext highlighter-rouge">ldapsearch</code>, <code class="language-plaintext highlighter-rouge">ldapmodify</code>, <code class="language-plaintext highlighter-rouge">impacket</code>, or <code class="language-plaintext highlighter-rouge">bloodhound</code> will be our guide. Instead, we’ll roll up our sleeves and create a simple yet powerful tool using <code class="language-plaintext highlighter-rouge">Python3</code> and <code class="language-plaintext highlighter-rouge">ldap3</code>.</p><h3 id="why-create-our-tool"><span class="mr-2">Why create our tool?</span><a href="#why-create-our-tool" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Because understanding the mechanics behind the tools we use is essential. Many cybersecurity enthusiasts jump straight into using tools without unraveling the magic behind them. This blog aims to demystify the process, empowering you to interact with LDAP directly and comprehend the intricacies of <code class="language-plaintext highlighter-rouge">Active Directory enumeration</code>, <code class="language-plaintext highlighter-rouge">information retrieval</code>, and <code class="language-plaintext highlighter-rouge">object modification</code>.</p><h3 id="whats-on-the-agenda"><span class="mr-2">What’s on the agenda?</span><a href="#whats-on-the-agenda" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>We’ll cover everything from establishing a connection to Active Directory using ldap3, searching for users and groups, to modifying and adding objects like a pro. By the end, you’ll not only grasp how these operations are performed but also be equipped to create your own <code class="language-plaintext highlighter-rouge">LDAP-interacting</code> tools from scratch.</p><p>So, buckle up as we dive into the realm of LDAP and Active Directory, where you’ll emerge with the skills to navigate and manipulate directories with confidence. Let’s begin this journey, empowering you to be the master of your tools and the architect of your cybersecurity strategies.</p><h2 id="introduction-to-ldap3-"><span class="mr-2">Introduction to ldap3 :</span><a href="#introduction-to-ldap3-" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p><code class="language-plaintext highlighter-rouge">ldap3</code> is a Python library for interacting with LDAP (Lightweight Directory Access Protocol) servers. It provides a convenient and Pythonic way to perform LDAP operations, such as <code class="language-plaintext highlighter-rouge">querying</code>, <code class="language-plaintext highlighter-rouge">adding</code>, <code class="language-plaintext highlighter-rouge">modifying</code>, and <code class="language-plaintext highlighter-rouge">deleting entries</code> in LDAP directories.</p><h3 id="installation-"><span class="mr-2">Installation :</span><a href="#installation-" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>You can download and install <code class="language-plaintext highlighter-rouge">ldap3</code> directly from its GitHub source :</p><p><a href="https://github.com/cannatag/ldap3">https://github.com/cannatag/ldap3</a></p><p>and then</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>python setup.py <span class="nb">install</span>
</pre></table></code></div></div><p>Or install the ldap3 library directly from pyPI:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>pip3 <span class="nb">install </span>ldap3
</pre></table></code></div></div><h2 id="active-directory-environment-"><span class="mr-2">Active directory Environment :</span><a href="#active-directory-environment-" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Assuming you’ve installed Windows Server and configured Active Directory, ensure LDAP access is set up. If you’re unfamiliar with this process, refer to my previous post, <a href="https://mostafatoumi.github.io/posts/ADDC-LAB-PART_01/">Active Directory Mastery - A Guide to Windows Server Setup for Penetration Testing.</a> Once your environment is ready, let’s Connecting to Active Directory with Python and ldap3</p><h2 id="connecting-to-active-directory-with-python-and-ldap3-"><span class="mr-2">Connecting to Active Directory with Python and ldap3 :</span><a href="#connecting-to-active-directory-with-python-and-ldap3-" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><h3 id="importing-object"><span class="mr-2">Importing Object</span><a href="#importing-object" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>we need to imports 3 specific components from the <code class="language-plaintext highlighter-rouge">ldap3</code> module:</p><p><code class="language-plaintext highlighter-rouge">Server:</code> Represents an LDAP server like <code class="language-plaintext highlighter-rouge">ldap://ex.example.com</code></p><p><code class="language-plaintext highlighter-rouge">Connection:</code> Represents a connection to an LDAP server.</p><p><code class="language-plaintext highlighter-rouge">SAFE_SYNC:</code> Represents a synchronous (blocking) connection mode with safety checks. <code class="language-plaintext highlighter-rouge">ALL:</code> To retrieve all info about entries</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>from ldap3 import Server, Connection, ALL
</pre></table></code></div></div><p>Now, we’ve imported the essential namespaces, <code class="language-plaintext highlighter-rouge">Server</code> and <code class="language-plaintext highlighter-rouge">Connection</code>. In the <code class="language-plaintext highlighter-rouge">LDAP</code> protocol, authentication is referred to as <code class="language-plaintext highlighter-rouge">Bind</code> which I explained in my <a href="https://mostafatoumi.github.io/posts/LDAP/">LDAP</a> post. You can refer to it for more details. In LDAP, there are three types of Bind connections: <code class="language-plaintext highlighter-rouge">Anonymous Bind</code>, <code class="language-plaintext highlighter-rouge">Simple Password Bind</code>, and <code class="language-plaintext highlighter-rouge">SASL</code>.</p><p>Let’s start with the anonymous bind</p><h3 id="anonymous-bind-"><span class="mr-2">Anonymous Bind :</span><a href="#anonymous-bind-" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Let’s start accessing the server with an anonymous bind:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="o">&gt;&gt;&gt;</span> from ldap3 import Server, Connection, ALL
<span class="o">&gt;&gt;&gt;</span> srv <span class="o">=</span> Server<span class="o">(</span><span class="s2">"emsec.emsec.htb"</span><span class="o">)</span>
<span class="o">&gt;&gt;&gt;</span> conn <span class="o">=</span> Connection<span class="o">(</span>srv, <span class="nv">auto_bind</span><span class="o">=</span>True<span class="o">)</span>

</pre></table></code></div></div><p>so if we Displays information about the connection object, showing details like server host, port, authentication method, etc.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="o">&gt;&gt;&gt;</span> conn
Connection<span class="o">(</span><span class="nv">server</span><span class="o">=</span>Server<span class="o">(</span><span class="nv">host</span><span class="o">=</span><span class="s1">'emsec.emsec.htb'</span>, <span class="nv">port</span><span class="o">=</span>389, <span class="nv">use_ssl</span><span class="o">=</span>False, <span class="nv">allowed_referral_hosts</span><span class="o">=[(</span><span class="s1">'*'</span>, True<span class="o">)]</span>, <span class="nv">get_info</span><span class="o">=</span><span class="s1">'SCHEMA'</span>, <span class="nv">mode</span><span class="o">=</span><span class="s1">'IP_V6_PREFERRED'</span><span class="o">)</span>, <span class="nv">auto_bind</span><span class="o">=</span><span class="s1">'NO_TLS'</span>, <span class="nv">version</span><span class="o">=</span>3, <span class="nv">authentication</span><span class="o">=</span><span class="s1">'ANONYMOUS'</span>, <span class="nv">client_strategy</span><span class="o">=</span><span class="s1">'SYNC'</span>, <span class="nv">auto_referrals</span><span class="o">=</span>True, <span class="nv">check_names</span><span class="o">=</span>True, <span class="nv">read_only</span><span class="o">=</span>False, <span class="nv">lazy</span><span class="o">=</span>False, <span class="nv">raise_exceptions</span><span class="o">=</span>False, <span class="nv">fast_decoder</span><span class="o">=</span>True, <span class="nv">auto_range</span><span class="o">=</span>True, <span class="nv">return_empty_attributes</span><span class="o">=</span>True, <span class="nv">auto_encode</span><span class="o">=</span>True, <span class="nv">auto_escape</span><span class="o">=</span>True, <span class="nv">use_referral_cache</span><span class="o">=</span>False<span class="o">)</span>
<span class="o">&gt;&gt;&gt;</span>
</pre></table></code></div></div><p>I want you to know that there are four connection strategies: <code class="language-plaintext highlighter-rouge">SYNC</code>, <code class="language-plaintext highlighter-rouge">ASYNC</code>, <code class="language-plaintext highlighter-rouge">RESTARTABLE</code>, and <code class="language-plaintext highlighter-rouge">REUSABLE</code>. In our case, we’re using SYNC, as indicated in the <code class="language-plaintext highlighter-rouge">conn</code> result with <code class="language-plaintext highlighter-rouge">client_strategy='SYN'C</code>. This is the default strategy, which means the client waits for the server’s response before proceeding with further operations.</p><p>also we Prints information about the Server object, showing details like host, port, and SSL usage the same way we do with connection :</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="o">&gt;&gt;&gt;</span> srv
Server<span class="o">(</span><span class="nv">host</span><span class="o">=</span><span class="s1">'emsec.emsec.htb'</span>, <span class="nv">port</span><span class="o">=</span>389, <span class="nv">use_ssl</span><span class="o">=</span>False, <span class="nv">allowed_referral_hosts</span><span class="o">=[(</span><span class="s1">'*'</span>, True<span class="o">)]</span>, <span class="nv">get_info</span><span class="o">=</span><span class="s1">'SCHEMA'</span>, <span class="nv">mode</span><span class="o">=</span><span class="s1">'IP_V6_PREFERRED'</span><span class="o">)</span>
</pre></table></code></div></div><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="o">&gt;&gt;&gt;</span> print<span class="o">(</span>conn<span class="o">)</span>
ldap://emsec.emsec.htb:389 - cleartext - user: None - not lazy - bound - open - &lt;<span class="nb">local</span>: 10.10.10.40:53937 - remote: 10.10.10.10:389&gt; - tls not started - listening - SyncStrategy - internal 
decoder
<span class="o">&gt;&gt;&gt;</span>
</pre></table></code></div></div><p>From the <code class="language-plaintext highlighter-rouge">print(conn)</code> result, we observed that it’s a <code class="language-plaintext highlighter-rouge">cleartext</code> connection, which is the type the server is currently listening to. We’ll explore how to switch to SSL and how to use secure ldap later.</p><ul><li>LDAP Connection Details</ul><div class="table-wrapper"><table><thead><tr><th>Syntax<th>Description<tbody><tr><td>Supported LDAP Versions<td>Server supports LDAP 2 and 3<tr><td>Naming Contexts<td>Server stores information for 3 different DIT partitions<tr><td>Alternative Servers<td>This is the only replica of the database<tr><td>Supported Controls<td>Optional controls that can be sent in a request operation<tr><td>Supported Extensions<td>Additional extended operations understood by the server<tr><td>Supported SASL Mechanisms<td>Different additional SASL authentication mechanisms<tr><td>Schema Entry<td>The location of the schema in the DIT<tr><td>Vendor Name<td>The brand/mark/name of this LDAP server<tr><td>Vendor Version<td>The version of this LDAP server</table></div><h3 id="getting-information-from-the-server-anonymous-bind"><span class="mr-2">Getting Information from the server (Anonymous Bind):</span><a href="#getting-information-from-the-server-anonymous-bind" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>I should note that we are currently in an <code class="language-plaintext highlighter-rouge">Anonymous Bind</code>, attempting to gather information from the server.</p><p>but first we need to specify the <code class="language-plaintext highlighter-rouge">get_info=ALL</code> parameter indicates that when establishing a connection, the client should request all available information about the LDAP server.</p><p>also the<code class="language-plaintext highlighter-rouge"> auto_bind=True</code> which indicates that the connection should be automatically established upon creation.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
</pre><td class="rouge-code"><pre><span class="o">&gt;&gt;&gt;</span> <span class="n">server</span> <span class="o">=</span> <span class="nc">Server</span><span class="p">(</span><span class="sh">'</span><span class="s">emsec.emsec.htb</span><span class="sh">'</span><span class="p">,</span>  <span class="n">get_info</span><span class="o">=</span><span class="n">ALL</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">conn</span> <span class="o">=</span> <span class="nc">Connection</span><span class="p">(</span><span class="n">server</span><span class="p">,</span> <span class="n">auto_bind</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">server</span><span class="p">.</span><span class="n">info</span>
<span class="n">DSA</span> <span class="nf">info </span><span class="p">(</span><span class="k">from</span> <span class="n">DSE</span><span class="p">):</span>
  <span class="n">Supported</span> <span class="n">LDAP</span> <span class="n">versions</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span>
  <span class="n">Naming</span> <span class="n">contexts</span><span class="p">:</span> 
    <span class="n">DC</span><span class="o">=</span><span class="n">emsec</span><span class="p">,</span><span class="n">DC</span><span class="o">=</span><span class="n">htb</span>
    <span class="n">CN</span><span class="o">=</span><span class="n">Configuration</span><span class="p">,</span><span class="n">DC</span><span class="o">=</span><span class="n">emsec</span><span class="p">,</span><span class="n">DC</span><span class="o">=</span><span class="n">htb</span>
    <span class="n">CN</span><span class="o">=</span><span class="n">Schema</span><span class="p">,</span><span class="n">CN</span><span class="o">=</span><span class="n">Configuration</span><span class="p">,</span><span class="n">DC</span><span class="o">=</span><span class="n">emsec</span><span class="p">,</span><span class="n">DC</span><span class="o">=</span><span class="n">htb</span>
    <span class="n">DC</span><span class="o">=</span><span class="n">DomainDnsZones</span><span class="p">,</span><span class="n">DC</span><span class="o">=</span><span class="n">emsec</span><span class="p">,</span><span class="n">DC</span><span class="o">=</span><span class="n">htb</span>
    <span class="n">DC</span><span class="o">=</span><span class="n">ForestDnsZones</span><span class="p">,</span><span class="n">DC</span><span class="o">=</span><span class="n">emsec</span><span class="p">,</span><span class="n">DC</span><span class="o">=</span><span class="n">htb</span>
  <span class="n">Supported</span> <span class="n">controls</span><span class="p">:</span> 
    <span class="mf">1.2</span><span class="p">.</span><span class="mf">840.113556</span><span class="p">.</span><span class="mf">1.4</span><span class="p">.</span><span class="mi">1338</span> <span class="o">-</span> <span class="n">Verify</span> <span class="n">name</span> <span class="o">-</span> <span class="n">Control</span> <span class="o">-</span> <span class="n">MICROSOFT</span>
    <span class="mf">1.2</span><span class="p">.</span><span class="mf">840.113556</span><span class="p">.</span><span class="mf">1.4</span><span class="p">.</span><span class="mi">1339</span> <span class="o">-</span> <span class="n">Domain</span> <span class="n">scope</span> <span class="o">-</span> <span class="n">Control</span> <span class="o">-</span> <span class="n">MICROSOFT</span>
    <span class="mf">1.2</span><span class="p">.</span><span class="mf">840.113556</span><span class="p">.</span><span class="mf">1.4</span><span class="p">.</span><span class="mi">1340</span> <span class="o">-</span> <span class="n">Search</span> <span class="n">options</span> <span class="o">-</span> <span class="n">Control</span> <span class="o">-</span> <span class="n">MICROSOFT</span>
    <span class="mf">1.2</span><span class="p">.</span><span class="mf">840.113556</span><span class="p">.</span><span class="mf">1.4</span><span class="p">.</span><span class="mi">1341</span> <span class="o">-</span> <span class="n">RODC</span> <span class="n">DCPROMO</span> <span class="o">-</span> <span class="n">Control</span> <span class="o">-</span> <span class="n">MICROSOFT</span>
    <span class="mf">1.2</span><span class="p">.</span><span class="mf">840.113556</span><span class="p">.</span><span class="mf">1.4</span><span class="p">.</span><span class="mi">1413</span> <span class="o">-</span> <span class="n">Permissive</span> <span class="n">modify</span> <span class="o">-</span> <span class="n">Control</span> <span class="o">-</span> <span class="n">MICROSOFT</span>
    <span class="mf">1.2</span><span class="p">.</span><span class="mf">840.113556</span><span class="p">.</span><span class="mf">1.4</span><span class="p">.</span><span class="mi">1504</span> <span class="o">-</span> <span class="n">Attribute</span> <span class="n">scoped</span> <span class="n">query</span> <span class="o">-</span> <span class="n">Control</span> <span class="o">-</span> <span class="n">MICROSOFT</span>
    <span class="mf">1.2</span><span class="p">.</span><span class="mf">840.113556</span><span class="p">.</span><span class="mf">1.4</span><span class="p">.</span><span class="mi">1852</span> <span class="o">-</span> <span class="n">User</span> <span class="n">quota</span> <span class="o">-</span> <span class="n">Control</span> <span class="o">-</span> <span class="n">MICROSOFT</span>
    <span class="mf">1.2</span><span class="p">.</span><span class="mf">840.113556</span><span class="p">.</span><span class="mf">1.4</span><span class="p">.</span><span class="mi">1907</span> <span class="o">-</span> <span class="n">Server</span> <span class="n">shutdown</span> <span class="n">notify</span> <span class="o">-</span> <span class="n">Control</span> <span class="o">-</span> <span class="n">MICROSOFT</span>
    <span class="mf">1.2</span><span class="p">.</span><span class="mf">840.113556</span><span class="p">.</span><span class="mf">1.4</span><span class="p">.</span><span class="mi">1948</span> <span class="o">-</span> <span class="n">Range</span> <span class="n">retrieval</span> <span class="n">no</span> <span class="n">error</span> <span class="o">-</span> <span class="n">Control</span> <span class="o">-</span> <span class="n">MICROSOFT</span>
    <span class="mf">1.2</span><span class="p">.</span><span class="mf">840.113556</span><span class="p">.</span><span class="mf">1.4</span><span class="p">.</span><span class="mi">1974</span> <span class="o">-</span> <span class="n">Server</span> <span class="n">force</span> <span class="n">update</span> <span class="o">-</span> <span class="n">Control</span> <span class="o">-</span> <span class="n">MICROSOFT</span>
    <span class="mf">1.2</span><span class="p">.</span><span class="mf">840.113556</span><span class="p">.</span><span class="mf">1.4</span><span class="p">.</span><span class="mi">2026</span> <span class="o">-</span> <span class="n">Input</span> <span class="n">DN</span> <span class="o">-</span> <span class="n">Control</span> <span class="o">-</span> <span class="n">MICROSOFT</span>
    <span class="mf">1.2</span><span class="p">.</span><span class="mf">840.113556</span><span class="p">.</span><span class="mf">1.4</span><span class="p">.</span><span class="mi">2064</span> <span class="o">-</span> <span class="n">Show</span> <span class="n">recycled</span> <span class="o">-</span> <span class="n">Control</span> <span class="o">-</span> <span class="n">MICROSOFT</span>
    <span class="mf">1.2</span><span class="p">.</span><span class="mf">840.113556</span><span class="p">.</span><span class="mf">1.4</span><span class="p">.</span><span class="mi">2065</span> <span class="o">-</span> <span class="n">Show</span> <span class="n">deactivated</span> <span class="n">link</span> <span class="o">-</span> <span class="n">Control</span> <span class="o">-</span> <span class="n">MICROSOFT</span>
    <span class="mf">1.2</span><span class="p">.</span><span class="mf">840.113556</span><span class="p">.</span><span class="mf">1.4</span><span class="p">.</span><span class="mi">2066</span> <span class="o">-</span> <span class="n">Policy</span> <span class="n">hints</span> <span class="p">[</span><span class="n">DEPRECATED</span><span class="p">]</span> <span class="o">-</span> <span class="n">Control</span> <span class="o">-</span> <span class="n">MICROSOFT</span>
    <span class="mf">1.2</span><span class="p">.</span><span class="mf">840.113556</span><span class="p">.</span><span class="mf">1.4</span><span class="p">.</span><span class="mi">2090</span> <span class="o">-</span> <span class="n">DirSync</span> <span class="n">EX</span> <span class="o">-</span> <span class="n">Control</span> <span class="o">-</span> <span class="n">MICROSOFT</span>
    <span class="mf">1.2</span><span class="p">.</span><span class="mf">840.113556</span><span class="p">.</span><span class="mf">1.4</span><span class="p">.</span><span class="mi">2204</span> <span class="o">-</span> <span class="n">Tree</span> <span class="n">deleted</span> <span class="n">EX</span> <span class="o">-</span> <span class="n">Control</span> <span class="o">-</span> <span class="n">MICROSOFT</span>
    <span class="mf">1.2</span><span class="p">.</span><span class="mf">840.113556</span><span class="p">.</span><span class="mf">1.4</span><span class="p">.</span><span class="mi">2205</span> <span class="o">-</span> <span class="n">Updates</span> <span class="n">stats</span> <span class="o">-</span> <span class="n">Control</span> <span class="o">-</span> <span class="n">MICROSOFT</span>
    <span class="mf">1.2</span><span class="p">.</span><span class="mf">840.113556</span><span class="p">.</span><span class="mf">1.4</span><span class="p">.</span><span class="mi">2206</span> <span class="o">-</span> <span class="n">Search</span> <span class="n">hints</span> <span class="o">-</span> <span class="n">Control</span> <span class="o">-</span> <span class="n">MICROSOFT</span>
    <span class="mf">1.2</span><span class="p">.</span><span class="mf">840.113556</span><span class="p">.</span><span class="mf">1.4</span><span class="p">.</span><span class="mi">2211</span> <span class="o">-</span> <span class="n">Expected</span> <span class="n">entry</span> <span class="n">count</span> <span class="o">-</span> <span class="n">Control</span> <span class="o">-</span> <span class="n">MICROSOFT</span>
    <span class="mf">1.2</span><span class="p">.</span><span class="mf">840.113556</span><span class="p">.</span><span class="mf">1.4</span><span class="p">.</span><span class="mi">2239</span> <span class="o">-</span> <span class="n">Policy</span> <span class="n">hints</span> <span class="o">-</span> <span class="n">Control</span> <span class="o">-</span> <span class="n">MICROSOFT</span>
    <span class="mf">1.2</span><span class="p">.</span><span class="mf">840.113556</span><span class="p">.</span><span class="mf">1.4</span><span class="p">.</span><span class="mi">2255</span> <span class="o">-</span> <span class="n">Set</span> <span class="n">owner</span> <span class="o">-</span> <span class="n">Control</span> <span class="o">-</span> <span class="n">MICROSOFT</span>
    <span class="mf">1.2</span><span class="p">.</span><span class="mf">840.113556</span><span class="p">.</span><span class="mf">1.4</span><span class="p">.</span><span class="mi">2256</span> <span class="o">-</span> <span class="n">Bypass</span> <span class="n">quota</span> <span class="o">-</span> <span class="n">Control</span> <span class="o">-</span> <span class="n">MICROSOFT</span>
    <span class="mf">1.2</span><span class="p">.</span><span class="mf">840.113556</span><span class="p">.</span><span class="mf">1.4</span><span class="p">.</span><span class="mi">2309</span>
    <span class="mf">1.2</span><span class="p">.</span><span class="mf">840.113556</span><span class="p">.</span><span class="mf">1.4</span><span class="p">.</span><span class="mi">2330</span>
    <span class="mf">1.2</span><span class="p">.</span><span class="mf">840.113556</span><span class="p">.</span><span class="mf">1.4</span><span class="p">.</span><span class="mi">2354</span>
    <span class="mf">1.2</span><span class="p">.</span><span class="mf">840.113556</span><span class="p">.</span><span class="mf">1.4</span><span class="p">.</span><span class="mi">319</span> <span class="o">-</span> <span class="n">LDAP</span> <span class="n">Simple</span> <span class="n">Paged</span> <span class="n">Results</span> <span class="o">-</span> <span class="n">Control</span> <span class="o">-</span> <span class="n">RFC2696</span>
    <span class="mf">1.2</span><span class="p">.</span><span class="mf">840.113556</span><span class="p">.</span><span class="mf">1.4</span><span class="p">.</span><span class="mi">417</span> <span class="o">-</span> <span class="n">LDAP</span> <span class="n">server</span> <span class="n">show</span> <span class="n">deleted</span> <span class="n">objects</span> <span class="o">-</span> <span class="n">Control</span> <span class="o">-</span> <span class="n">MICROSOFT</span>
    <span class="mf">1.2</span><span class="p">.</span><span class="mf">840.113556</span><span class="p">.</span><span class="mf">1.4</span><span class="p">.</span><span class="mi">473</span> <span class="o">-</span> <span class="n">Sort</span> <span class="n">Request</span> <span class="o">-</span> <span class="n">Control</span> <span class="o">-</span> <span class="n">RFC2891</span>
    <span class="mf">1.2</span><span class="p">.</span><span class="mf">840.113556</span><span class="p">.</span><span class="mf">1.4</span><span class="p">.</span><span class="mi">474</span> <span class="o">-</span> <span class="n">Sort</span> <span class="n">Response</span> <span class="o">-</span> <span class="n">Control</span> <span class="o">-</span> <span class="n">RFC2891</span>
    <span class="mf">1.2</span><span class="p">.</span><span class="mf">840.113556</span><span class="p">.</span><span class="mf">1.4</span><span class="p">.</span><span class="mi">521</span> <span class="o">-</span> <span class="n">Cross</span><span class="o">-</span><span class="n">domain</span> <span class="n">move</span> <span class="o">-</span> <span class="n">Control</span> <span class="o">-</span> <span class="n">MICROSOFT</span>
    <span class="mf">1.2</span><span class="p">.</span><span class="mf">840.113556</span><span class="p">.</span><span class="mf">1.4</span><span class="p">.</span><span class="mi">528</span> <span class="o">-</span> <span class="n">Server</span> <span class="n">search</span> <span class="n">notification</span> <span class="o">-</span> <span class="n">Control</span> <span class="o">-</span> <span class="n">MICROSOFT</span>
    <span class="mf">1.2</span><span class="p">.</span><span class="mf">840.113556</span><span class="p">.</span><span class="mf">1.4</span><span class="p">.</span><span class="mi">529</span> <span class="o">-</span> <span class="n">Extended</span> <span class="n">DN</span> <span class="o">-</span> <span class="n">Control</span> <span class="o">-</span> <span class="n">MICROSOFT</span>
    <span class="mf">1.2</span><span class="p">.</span><span class="mf">840.113556</span><span class="p">.</span><span class="mf">1.4</span><span class="p">.</span><span class="mi">619</span> <span class="o">-</span> <span class="n">Lazy</span> <span class="n">commit</span> <span class="o">-</span> <span class="n">Control</span> <span class="o">-</span> <span class="n">MICROSOFT</span>
    <span class="mf">1.2</span><span class="p">.</span><span class="mf">840.113556</span><span class="p">.</span><span class="mf">1.4</span><span class="p">.</span><span class="mi">801</span> <span class="o">-</span> <span class="n">Security</span> <span class="n">descriptor</span> <span class="n">flags</span> <span class="o">-</span> <span class="n">Control</span> <span class="o">-</span> <span class="n">MICROSOFT</span>
    <span class="mf">1.2</span><span class="p">.</span><span class="mf">840.113556</span><span class="p">.</span><span class="mf">1.4</span><span class="p">.</span><span class="mi">802</span> <span class="o">-</span> <span class="n">Range</span> <span class="n">option</span> <span class="o">-</span> <span class="n">Control</span> <span class="o">-</span> <span class="n">MICROSOFT</span>
    <span class="mf">1.2</span><span class="p">.</span><span class="mf">840.113556</span><span class="p">.</span><span class="mf">1.4</span><span class="p">.</span><span class="mi">805</span> <span class="o">-</span> <span class="n">Tree</span> <span class="n">delete</span> <span class="o">-</span> <span class="n">Control</span> <span class="o">-</span> <span class="n">MICROSOFT</span>
    <span class="mf">1.2</span><span class="p">.</span><span class="mf">840.113556</span><span class="p">.</span><span class="mf">1.4</span><span class="p">.</span><span class="mi">841</span> <span class="o">-</span> <span class="n">Directory</span> <span class="n">synchronization</span> <span class="o">-</span> <span class="n">Control</span> <span class="o">-</span> <span class="n">MICROSOFT</span>
    <span class="mf">1.2</span><span class="p">.</span><span class="mf">840.113556</span><span class="p">.</span><span class="mf">1.4</span><span class="p">.</span><span class="mi">970</span> <span class="o">-</span> <span class="n">Get</span> <span class="n">stats</span> <span class="o">-</span> <span class="n">Control</span> <span class="o">-</span> <span class="n">MICROSOFT</span>
    <span class="mf">2.16</span><span class="p">.</span><span class="mf">840.1</span><span class="p">.</span><span class="mf">113730.3</span><span class="p">.</span><span class="mf">4.10</span> <span class="o">-</span> <span class="n">Virtual</span> <span class="n">List</span> <span class="n">View</span> <span class="n">Response</span> <span class="o">-</span> <span class="n">Control</span> <span class="o">-</span> <span class="n">IETF</span>
    <span class="mf">2.16</span><span class="p">.</span><span class="mf">840.1</span><span class="p">.</span><span class="mf">113730.3</span><span class="p">.</span><span class="mf">4.9</span> <span class="o">-</span> <span class="n">Virtual</span> <span class="n">List</span> <span class="n">View</span> <span class="n">Request</span> <span class="o">-</span> <span class="n">Control</span> <span class="o">-</span> <span class="n">IETF</span>
  <span class="n">Supported</span> <span class="n">extensions</span><span class="p">:</span> 
    <span class="mf">1.2</span><span class="p">.</span><span class="mf">840.113556</span><span class="p">.</span><span class="mf">1.4</span><span class="p">.</span><span class="mi">1781</span> <span class="o">-</span> <span class="n">Fast</span> <span class="n">concurrent</span> <span class="n">bind</span> <span class="o">-</span> <span class="n">Extension</span> <span class="o">-</span> <span class="n">MICROSOFT</span>
    <span class="mf">1.2</span><span class="p">.</span><span class="mf">840.113556</span><span class="p">.</span><span class="mf">1.4</span><span class="p">.</span><span class="mi">2212</span> <span class="o">-</span> <span class="n">Batch</span> <span class="n">request</span> <span class="o">-</span> <span class="n">Extension</span> <span class="o">-</span> <span class="n">MICROSOFT</span>
    <span class="mf">1.3</span><span class="p">.</span><span class="mf">6.1</span><span class="p">.</span><span class="mf">4.1</span><span class="p">.</span><span class="mf">1466.101</span><span class="p">.</span><span class="mf">119.1</span> <span class="o">-</span> <span class="n">Dynamic</span> <span class="n">Refresh</span> <span class="o">-</span> <span class="n">Extension</span> <span class="o">-</span> <span class="n">RFC2589</span>
    <span class="mf">1.3</span><span class="p">.</span><span class="mf">6.1</span><span class="p">.</span><span class="mf">4.1</span><span class="p">.</span><span class="mf">1466.20037</span> <span class="o">-</span> <span class="n">StartTLS</span> <span class="o">-</span> <span class="n">Extension</span> <span class="o">-</span> <span class="n">RFC4511</span><span class="o">-</span><span class="n">RFC4513</span>
    <span class="mf">1.3</span><span class="p">.</span><span class="mf">6.1</span><span class="p">.</span><span class="mf">4.1</span><span class="p">.</span><span class="mf">4203.1</span><span class="p">.</span><span class="mf">11.3</span> <span class="o">-</span> <span class="n">Who</span> <span class="n">am</span> <span class="n">I</span> <span class="o">-</span> <span class="n">Extension</span> <span class="o">-</span> <span class="n">RFC4532</span>
  <span class="n">Supported</span> <span class="n">features</span><span class="p">:</span> 
    <span class="mf">1.2</span><span class="p">.</span><span class="mf">840.113556</span><span class="p">.</span><span class="mf">1.4</span><span class="p">.</span><span class="mi">1670</span> <span class="o">-</span> <span class="n">Active</span> <span class="n">directory</span> <span class="n">V51</span> <span class="o">-</span> <span class="n">Feature</span> <span class="o">-</span> <span class="n">MICROSOFT</span>
    <span class="mf">1.2</span><span class="p">.</span><span class="mf">840.113556</span><span class="p">.</span><span class="mf">1.4</span><span class="p">.</span><span class="mi">1791</span> <span class="o">-</span> <span class="n">Active</span> <span class="n">directory</span> <span class="n">LDAP</span> <span class="n">Integration</span> <span class="o">-</span> <span class="n">Feature</span> <span class="o">-</span> <span class="n">MICROSOFT</span>
    <span class="mf">1.2</span><span class="p">.</span><span class="mf">840.113556</span><span class="p">.</span><span class="mf">1.4</span><span class="p">.</span><span class="mi">1935</span> <span class="o">-</span> <span class="n">Active</span> <span class="n">directory</span> <span class="n">V60</span> <span class="o">-</span> <span class="n">Feature</span> <span class="o">-</span> <span class="n">MICROSOFT</span>
    <span class="mf">1.2</span><span class="p">.</span><span class="mf">840.113556</span><span class="p">.</span><span class="mf">1.4</span><span class="p">.</span><span class="mi">2080</span> <span class="o">-</span> <span class="n">Active</span> <span class="n">directory</span> <span class="n">V61</span> <span class="n">R2</span> <span class="o">-</span> <span class="n">Feature</span> <span class="o">-</span> <span class="n">MICROSOFT</span>
    <span class="mf">1.2</span><span class="p">.</span><span class="mf">840.113556</span><span class="p">.</span><span class="mf">1.4</span><span class="p">.</span><span class="mi">2237</span> <span class="o">-</span> <span class="n">Active</span> <span class="n">directory</span> <span class="n">W8</span> <span class="o">-</span> <span class="n">Feature</span> <span class="o">-</span> <span class="n">MICROSOFT</span>
    <span class="mf">1.2</span><span class="p">.</span><span class="mf">840.113556</span><span class="p">.</span><span class="mf">1.4</span><span class="p">.</span><span class="mi">800</span> <span class="o">-</span> <span class="n">Active</span> <span class="n">directory</span> <span class="o">-</span> <span class="n">Feature</span> <span class="o">-</span> <span class="n">MICROSOFT</span>
  <span class="n">Supported</span> <span class="n">SASL</span> <span class="n">mechanisms</span><span class="p">:</span> 
    <span class="n">GSSAPI</span><span class="p">,</span> <span class="n">GSS</span><span class="o">-</span><span class="n">SPNEGO</span><span class="p">,</span> <span class="n">EXTERNAL</span><span class="p">,</span> <span class="n">DIGEST</span><span class="o">-</span><span class="n">MD5</span>
  <span class="n">Schema</span> <span class="n">entry</span><span class="p">:</span> 
    <span class="n">CN</span><span class="o">=</span><span class="n">Aggregate</span><span class="p">,</span><span class="n">CN</span><span class="o">=</span><span class="n">Schema</span><span class="p">,</span><span class="n">CN</span><span class="o">=</span><span class="n">Configuration</span><span class="p">,</span><span class="n">DC</span><span class="o">=</span><span class="n">emsec</span><span class="p">,</span><span class="n">DC</span><span class="o">=</span><span class="n">htb</span>
<span class="n">Other</span><span class="p">:</span>
  <span class="n">domainFunctionality</span><span class="p">:</span> 
    <span class="mi">7</span>
  <span class="n">forestFunctionality</span><span class="p">:</span> 
    <span class="mi">7</span>
  <span class="n">domainControllerFunctionality</span><span class="p">:</span> 
    <span class="mi">7</span>
  <span class="n">rootDomainNamingContext</span><span class="p">:</span> 
    <span class="n">DC</span><span class="o">=</span><span class="n">emsec</span><span class="p">,</span><span class="n">DC</span><span class="o">=</span><span class="n">htb</span>
  <span class="n">ldapServiceName</span><span class="p">:</span> 
    <span class="n">emsec</span><span class="p">.</span><span class="n">htb</span><span class="p">:</span><span class="n">emsec</span><span class="err">$</span><span class="nd">@EMSEC.HTB</span>
  <span class="n">isGlobalCatalogReady</span><span class="p">:</span> 
    <span class="n">TRUE</span>
  <span class="n">supportedLDAPPolicies</span><span class="p">:</span> 
    <span class="n">MaxPoolThreads</span>
    <span class="n">MaxPercentDirSyncRequests</span>
    <span class="n">MaxDatagramRecv</span>
    <span class="n">MaxReceiveBuffer</span>
    <span class="n">InitRecvTimeout</span>
    <span class="n">MaxConnections</span>
    <span class="n">MaxConnIdleTime</span>
    <span class="n">MaxPageSize</span>
    <span class="n">MaxBatchReturnMessages</span>
    <span class="n">MaxQueryDuration</span>
    <span class="n">MaxDirSyncDuration</span>
    <span class="n">MaxTempTableSize</span>
    <span class="n">MaxResultSetSize</span>
    <span class="n">MinResultSets</span>
    <span class="n">MaxResultSetsPerConn</span>
    <span class="n">MaxNotificationPerConn</span>
    <span class="n">MaxValRange</span>
    <span class="n">MaxValRangeTransitive</span>
    <span class="n">ThreadMemoryLimit</span>
    <span class="n">SystemMemoryLimitPercent</span>
  <span class="n">serverName</span><span class="p">:</span> 
    <span class="n">CN</span><span class="o">=</span><span class="n">EMSEC</span><span class="p">,</span><span class="n">CN</span><span class="o">=</span><span class="n">Servers</span><span class="p">,</span><span class="n">CN</span><span class="o">=</span><span class="n">Default</span><span class="o">-</span><span class="n">First</span><span class="o">-</span><span class="n">Site</span><span class="o">-</span><span class="n">Name</span><span class="p">,</span><span class="n">CN</span><span class="o">=</span><span class="n">Sites</span><span class="p">,</span><span class="n">CN</span><span class="o">=</span><span class="n">Configuration</span><span class="p">,</span><span class="n">DC</span><span class="o">=</span><span class="n">emsec</span><span class="p">,</span><span class="n">DC</span><span class="o">=</span><span class="n">htb</span>
  <span class="n">schemaNamingContext</span><span class="p">:</span> 
    <span class="n">CN</span><span class="o">=</span><span class="n">Schema</span><span class="p">,</span><span class="n">CN</span><span class="o">=</span><span class="n">Configuration</span><span class="p">,</span><span class="n">DC</span><span class="o">=</span><span class="n">emsec</span><span class="p">,</span><span class="n">DC</span><span class="o">=</span><span class="n">htb</span>
  <span class="n">isSynchronized</span><span class="p">:</span> 
    <span class="n">TRUE</span>
  <span class="n">highestCommittedUSN</span><span class="p">:</span> 
    <span class="mi">323702</span>
  <span class="n">dsServiceName</span><span class="p">:</span> 
    <span class="n">CN</span><span class="o">=</span><span class="n">NTDS</span> <span class="n">Settings</span><span class="p">,</span><span class="n">CN</span><span class="o">=</span><span class="n">EMSEC</span><span class="p">,</span><span class="n">CN</span><span class="o">=</span><span class="n">Servers</span><span class="p">,</span><span class="n">CN</span><span class="o">=</span><span class="n">Default</span><span class="o">-</span><span class="n">First</span><span class="o">-</span><span class="n">Site</span><span class="o">-</span><span class="n">Name</span><span class="p">,</span><span class="n">CN</span><span class="o">=</span><span class="n">Sites</span><span class="p">,</span><span class="n">CN</span><span class="o">=</span><span class="n">Configuration</span><span class="p">,</span><span class="n">DC</span><span class="o">=</span><span class="n">emsec</span><span class="p">,</span><span class="n">DC</span><span class="o">=</span><span class="n">htb</span>
  <span class="n">dnsHostName</span><span class="p">:</span> 
    <span class="n">emsec</span><span class="p">.</span><span class="n">emsec</span><span class="p">.</span><span class="n">htb</span>
  <span class="n">defaultNamingContext</span><span class="p">:</span> 
    <span class="n">DC</span><span class="o">=</span><span class="n">emsec</span><span class="p">,</span><span class="n">DC</span><span class="o">=</span><span class="n">htb</span>
  <span class="n">currentTime</span><span class="p">:</span> 
    <span class="mf">20240114142516.0</span><span class="n">Z</span>
  <span class="n">configurationNamingContext</span><span class="p">:</span> 
    <span class="n">CN</span><span class="o">=</span><span class="n">Configuration</span><span class="p">,</span><span class="n">DC</span><span class="o">=</span><span class="n">emsec</span><span class="p">,</span><span class="n">DC</span><span class="o">=</span><span class="n">htb</span>


</pre></table></code></div></div><p>With <code class="language-plaintext highlighter-rouge">server.info</code>, we successfully retrieved information about the LDAP server using the <code class="language-plaintext highlighter-rouge">info</code> attribute of the Server object. However, our result is limited since we are binding as anonymous. We’ll find more useful information with Simple Password Bind and SASL Bind.</p><h2 id="simple-password-"><span class="mr-2">Simple Password :</span><a href="#simple-password-" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Simply put, with a <code class="language-plaintext highlighter-rouge">Simple Password Bind</code>, you provide a DN (Distinguished Name) and a password. The server then checks the validity of the credentials and either permits or denies access to the elements of the DIT (Directory Information Tree). On the other hand, for <code class="language-plaintext highlighter-rouge">SASL Bind</code>, we use an external certificate or a Kerberos ticket to identify the user.</p><p><strong><em>Note : The <code class="language-plaintext highlighter-rouge">Directory Information Tree (DIT)</code> is a hierarchical tree structure that organizes entries within a directory server. It is a fundamental concept in LDAP (Lightweight Directory Access Protocol) and represents the organization of directory entries.</em></strong></p><p>Here’s an example of the syntax for a DIT:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nv">cn</span><span class="o">=</span>John Doe,ou<span class="o">=</span>Users,dc<span class="o">=</span>emsec,dc<span class="o">=</span>htb

</pre></table></code></div></div><h2 id="simple-authentication-and-security-layer-sasl-"><span class="mr-2">Simple Authentication and Security Layer (SASL) :</span><a href="#simple-authentication-and-security-layer-sasl-" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>SASL is a framework for authentication, it allows client and server to negotiate an authentication method among those supported. SASL authentication adds 4 authentication subtypes:</p><p><a href="/assets/img/favicons/HackTheBox/ADDC-LDAP3/./SASL_ldap3.drawio.png" class="popup img-link "><img data-src="/assets/img/favicons/HackTheBox/ADDC-LDAP3/./SASL_ldap3.drawio.png" alt="SALS Methods auth" class="lazyload" data-proofer-ignore></a></p><ul><li><p><code class="language-plaintext highlighter-rouge">GSS-SPNEGO</code> : Simple and Protected <code class="language-plaintext highlighter-rouge">GSSAPI</code> Negotiation Mechanism, yet another protocol to negotiate authentication. Active Directory provides <code class="language-plaintext highlighter-rouge">NTLM</code> or <code class="language-plaintext highlighter-rouge">Kerberos</code> as underlaying methods.</p><li><p><code class="language-plaintext highlighter-rouge">GSSAPI</code> : Kerberos (GSSAPI is often used with Kerberos, a widely used authentication protocol that provides strong authentication and security features.)</p><li><p><code class="language-plaintext highlighter-rouge">EXTERNAL</code> : SASL EXTERNAL is a Simple Authentication and Security Layer mechanism that enables a client to authenticate itself to a server using credentials provided by the underlying transport layer, such as <code class="language-plaintext highlighter-rouge">SSL/TLS</code> certificates.</p><li><p><code class="language-plaintext highlighter-rouge">DIGEST-MD5</code> : Challenge-response authentication with message digest algorithm.</p></ul><h3 id="logging-into-the-server-"><span class="mr-2">Logging into the server :</span><a href="#logging-into-the-server-" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="n">ldap3</span> <span class="kn">import</span> <span class="n">Server</span><span class="p">,</span> <span class="n">Connection</span><span class="p">,</span> <span class="n">ALL</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">server</span> <span class="o">=</span> <span class="nc">Server</span><span class="p">(</span><span class="sh">'</span><span class="s">emsec.emsec.htb</span><span class="sh">'</span><span class="p">,</span> <span class="n">get_info</span><span class="o">=</span><span class="n">ALL</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">conn</span> <span class="o">=</span> <span class="nc">Connection</span><span class="p">(</span><span class="n">server</span><span class="p">,</span> <span class="sh">'</span><span class="s">user4</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Password@123!</span><span class="sh">'</span><span class="p">,</span> <span class="n">auto_bind</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">conn</span><span class="p">.</span><span class="n">extend</span><span class="p">.</span><span class="n">standard</span><span class="p">.</span><span class="nf">who_am_i</span><span class="p">()</span>
<span class="sh">'</span><span class="s">u:EMSEC0</span><span class="se">\\</span><span class="s">user4</span><span class="sh">'</span>
<span class="o">&gt;&gt;&gt;</span>
</pre></table></code></div></div><p>we checks that we are a valid user using <code class="language-plaintext highlighter-rouge">who_am_i()</code> and this extended operation returns our identity <code class="language-plaintext highlighter-rouge">u:EMSEC0\\user4</code></p><p><strong><em>Note: if you get empty response from <code class="language-plaintext highlighter-rouge">conn.extend.standard.who_am_i() .</code>This means you have no authentication status on the server, so you are an anonymous user.</em></strong></p><h2 id="establishing-a-secure-connection-"><span class="mr-2">Establishing a secure connection :</span><a href="#establishing-a-secure-connection-" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Previously, we used <code class="language-plaintext highlighter-rouge">print(conn)</code> to view the details of our connection, and it showed <code class="language-plaintext highlighter-rouge">cleartext</code> ,This means that credentials pass unencrypted over the wire (insecure LDAP: port 389). Also this raises concerns about the potential for password capture by anyone in the same network using tools like <code class="language-plaintext highlighter-rouge">Wireshark</code>, Such as shown below.</p><p><a href="/assets/img/favicons/HackTheBox/ADDC-LDAP3/./not_secure_ldap.png" class="popup img-link "><img data-src="/assets/img/favicons/HackTheBox/ADDC-LDAP3/./not_secure_ldap.png" alt="not secure connection ldap" class="lazyload" data-proofer-ignore></a></p><p>The LDAP protocol provides two ways to secure a connection: <code class="language-plaintext highlighter-rouge">LDAP over TLS</code> and the <code class="language-plaintext highlighter-rouge">StartTLS</code> extended operation. Both methods establish a secure TLS connection: the former secure with TLS the communication channel as soon as the connection is open, while the latter can be used at any time on an already open unsecure connection to secure it issuing the StartTLS operation.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="o">&gt;&gt;&gt;</span> from ldap3 import Server, Connection, ALL
<span class="o">&gt;&gt;&gt;</span> server  <span class="o">=</span> Server<span class="o">(</span><span class="s2">"emsec.emsec.htb"</span>,use_ssl<span class="o">=</span>True,get_info<span class="o">=</span>ALL<span class="o">)</span>
<span class="o">&gt;&gt;&gt;</span> conn <span class="o">=</span> Connection<span class="o">(</span>server, <span class="s1">'user4'</span>,<span class="s1">'Password@123!'</span>, <span class="nv">auto_bind</span><span class="o">=</span>True<span class="o">)</span>
<span class="o">&gt;&gt;&gt;</span> tls_result <span class="o">=</span> conn.start_tls<span class="o">()</span>
<span class="o">&gt;&gt;&gt;</span> print<span class="o">(</span>conn<span class="o">)</span>
ldaps://emsec.emsec.htb:636 - ssl - user: user4 - not lazy - bound - open - &lt;<span class="nb">local</span>: 10.10.10.40:43075 - remote: 10.10.10.10:636&gt; - tls not started - listening - SyncStrategy - internal decoder
</pre></table></code></div></div><p>Now, upon checking with <code class="language-plaintext highlighter-rouge">print(conn)</code>, we observe <code class="language-plaintext highlighter-rouge">ssl</code> instead of <code class="language-plaintext highlighter-rouge">cleartext</code>, indicating that we are now using a secure connection. However, TLS hasn’t started. This is because we haven’t specified any TLS options, and thus, there is no checking of certificate validity. To customize TLS behavior, you can provide a Tls object to the Server object (<a href="https://programtalk.com/python-more-examples/ldap3.Tls/">ldap3.Tls</a> )</p><p>Now with encrypted connections (SSL) a network sniffer can’t capture passwords or any other sensitive data:</p><p><a href="/assets/img/favicons/HackTheBox/ADDC-LDAP3/./ldap_ssl.png" class="popup img-link "><img data-src="/assets/img/favicons/HackTheBox/ADDC-LDAP3/./ldap_ssl.png" alt="ssl ldap" class="lazyload" data-proofer-ignore></a></p><h2 id="searching-for-users-and-groups-"><span class="mr-2">Searching for Users and Groups :</span><a href="#searching-for-users-and-groups-" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>uppose we need to enumerate LDAP using the ldap3 library. Before we begin, it’s important to note that to find entries in the DIT, you must use the Search operation. However, there are two mandatory parameters for the search operation: <code class="language-plaintext highlighter-rouge">search_base</code> which denotes the location in the DIT where the search will start, and <code class="language-plaintext highlighter-rouge">search_filter</code> a string that describes what you are searching for</p><h3 id="dump-all-users-"><span class="mr-2">Dump All Users :</span><a href="#dump-all-users-" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="n">ldap3</span> <span class="kn">import</span> <span class="n">Server</span><span class="p">,</span> <span class="n">Connection</span><span class="p">,</span> <span class="n">ALL</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">conn</span> <span class="o">=</span> <span class="nc">Connection</span><span class="p">(</span><span class="n">server</span><span class="p">,</span> <span class="sh">'</span><span class="s">user4</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Password@123!</span><span class="sh">'</span><span class="p">,</span> <span class="n">auto_bind</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">conn</span><span class="p">.</span><span class="nf">search</span><span class="p">(</span><span class="sh">'</span><span class="s">dc=emsec,dc=htb</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">(objectclass=person)</span><span class="sh">'</span><span class="p">)</span>
<span class="bp">True</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">conn</span><span class="p">.</span><span class="n">entries</span>
</pre></table></code></div></div><p><a href="/assets/img/favicons/HackTheBox/ADDC-LDAP3/./search_for_users.png" class="popup img-link "><img data-src="/assets/img/favicons/HackTheBox/ADDC-LDAP3/./search_for_users.png" alt="dump users" class="lazyload" data-proofer-ignore></a></p><p>Here, we are requesting all entries of the class <code class="language-plaintext highlighter-rouge">person</code>. This will display all users on our Windows server.</p><p>This operation is looking for entries in the LDAP directory that match the specified search criteria</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>conn.search<span class="o">(</span><span class="s1">'dc=emsec,dc=emsec,dc=htb'</span>, <span class="s1">'(objectclass=person)'</span><span class="o">)</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">dc=emsec,dc=emsec,dc=htb</code> : This specifies the starting point in the LDAP directory tree for the search.</p><p><code class="language-plaintext highlighter-rouge">(objectclass=person)</code> : This filter defines the conditions that entries must meet to be considered a match. In this case, it’s looking for entries with the objectClass attribute set to person.</p><h3 id="dump-all-groups-"><span class="mr-2">Dump All Groups :</span><a href="#dump-all-groups-" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>To dump users, we can simply change the filter from <code class="language-plaintext highlighter-rouge">'(objectclass=person)'</code> to <code class="language-plaintext highlighter-rouge">'(objectclass=group)'</code> This modification will retrieve all groups in the domain.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre><span class="o">&gt;&gt;&gt;</span> <span class="n">conn</span><span class="p">.</span><span class="nf">search</span><span class="p">(</span><span class="sh">'</span><span class="s">dc=emsec,dc=htb</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">(objectclass=groups)</span><span class="sh">'</span><span class="p">)</span>
<span class="bp">True</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">conn</span><span class="p">.</span><span class="n">entries</span>
<span class="p">[</span><span class="n">DN</span><span class="p">:</span> <span class="n">CN</span><span class="o">=</span><span class="n">Administrators</span><span class="p">,</span><span class="n">CN</span><span class="o">=</span><span class="n">Builtin</span><span class="p">,</span><span class="n">DC</span><span class="o">=</span><span class="n">emsec</span><span class="p">,</span><span class="n">DC</span><span class="o">=</span><span class="n">htb</span> <span class="o">-</span> <span class="n">STATUS</span><span class="p">:</span> <span class="n">Read</span> <span class="o">-</span> <span class="n">READ</span> <span class="n">TIME</span><span class="p">:</span> <span class="mi">2024</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">14</span><span class="n">T17</span><span class="p">:</span><span class="mi">10</span><span class="p">:</span><span class="mf">13.712388</span>
<span class="p">,</span> <span class="n">DN</span><span class="p">:</span> <span class="n">CN</span><span class="o">=</span><span class="n">Users</span><span class="p">,</span><span class="n">CN</span><span class="o">=</span><span class="n">Builtin</span><span class="p">,</span><span class="n">DC</span><span class="o">=</span><span class="n">emsec</span><span class="p">,</span><span class="n">DC</span><span class="o">=</span><span class="n">htb</span> <span class="o">-</span> <span class="n">STATUS</span><span class="p">:</span> <span class="n">Read</span> <span class="o">-</span> <span class="n">READ</span> <span class="n">TIME</span><span class="p">:</span> <span class="mi">2024</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">14</span><span class="n">T17</span><span class="p">:</span><span class="mi">10</span><span class="p">:</span><span class="mf">13.712492</span>
<span class="p">,</span> <span class="n">DN</span><span class="p">:</span> <span class="n">CN</span><span class="o">=</span><span class="n">Guests</span><span class="p">,</span><span class="n">CN</span><span class="o">=</span><span class="n">Builtin</span><span class="p">,</span><span class="n">DC</span><span class="o">=</span><span class="n">emsec</span><span class="p">,</span><span class="n">DC</span><span class="o">=</span><span class="n">htb</span> <span class="o">-</span> <span class="n">STATUS</span><span class="p">:</span> <span class="n">Read</span> <span class="o">-</span> <span class="n">READ</span> <span class="n">TIME</span><span class="p">:</span> <span class="mi">2024</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">14</span><span class="n">T17</span><span class="p">:</span><span class="mi">10</span><span class="p">:</span><span class="mf">13.712630</span>
<span class="p">,</span> <span class="n">DN</span><span class="p">:</span> <span class="n">CN</span><span class="o">=</span><span class="n">Print</span> <span class="n">Operators</span><span class="p">,</span><span class="n">CN</span><span class="o">=</span><span class="n">Builtin</span><span class="p">,</span><span class="n">DC</span><span class="o">=</span><span class="n">emsec</span><span class="p">,</span><span class="n">DC</span><span class="o">=</span><span class="n">htb</span> <span class="o">-</span> <span class="n">STATUS</span><span class="p">:</span> <span class="n">Read</span> <span class="o">-</span> <span class="n">READ</span> <span class="n">TIME</span><span class="p">:</span> <span class="mi">2024</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">14</span><span class="n">T17</span><span class="p">:</span><span class="mi">10</span><span class="p">:</span><span class="mf">13.712682</span>
<span class="p">,</span> <span class="n">DN</span><span class="p">:</span> <span class="n">CN</span><span class="o">=</span><span class="n">Backup</span> <span class="n">Operators</span><span class="p">,</span><span class="n">CN</span><span class="o">=</span><span class="n">Builtin</span><span class="p">,</span><span class="n">DC</span><span class="o">=</span><span class="n">emsec</span><span class="p">,</span><span class="n">DC</span><span class="o">=</span><span class="n">htb</span> <span class="o">-</span> <span class="n">STATUS</span><span class="p">:</span> <span class="n">Read</span> <span class="o">-</span> <span class="n">READ</span> <span class="n">TIME</span><span class="p">:</span> <span class="mi">2024</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">14</span><span class="n">T17</span><span class="p">:</span><span class="mi">10</span><span class="p">:</span><span class="mf">13.712723</span>
<span class="p">,</span> <span class="n">DN</span><span class="p">:</span> <span class="n">CN</span><span class="o">=</span><span class="n">Replicator</span><span class="p">,</span><span class="n">CN</span><span class="o">=</span><span class="n">Builtin</span><span class="p">,</span><span class="n">DC</span><span class="o">=</span><span class="n">emsec</span><span class="p">,</span><span class="n">DC</span><span class="o">=</span><span class="n">htb</span> <span class="o">-</span> <span class="n">STATUS</span><span class="p">:</span> <span class="n">Read</span> <span class="o">-</span> <span class="n">READ</span> <span class="n">TIME</span><span class="p">:</span> <span class="mi">2024</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">14</span><span class="n">T17</span><span class="p">:</span><span class="mi">10</span><span class="p">:</span><span class="mf">13.712827</span>
<span class="p">,</span> <span class="n">DN</span><span class="p">:</span> <span class="n">CN</span><span class="o">=</span><span class="n">Remote</span> <span class="n">Desktop</span> <span class="n">Users</span><span class="p">,</span><span class="n">CN</span><span class="o">=</span><span class="n">Builtin</span><span class="p">,</span><span class="n">DC</span><span class="o">=</span><span class="n">emsec</span><span class="p">,</span><span class="n">DC</span><span class="o">=</span><span class="n">htb</span> <span class="o">-</span> <span class="n">STATUS</span><span class="p">:</span> <span class="n">Read</span> <span class="o">-</span> <span class="n">READ</span> <span class="n">TIME</span><span class="p">:</span> <span class="mi">2024</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">14</span><span class="n">T17</span><span class="p">:</span><span class="mi">10</span><span class="p">:</span><span class="mf">13.714688</span>
<span class="p">,</span> <span class="n">DN</span><span class="p">:</span> <span class="n">CN</span><span class="o">=</span><span class="n">Network</span> <span class="n">Configuration</span> <span class="n">Operators</span><span class="p">,</span><span class="n">CN</span><span class="o">=</span><span class="n">Builtin</span><span class="p">,</span><span class="n">DC</span><span class="o">=</span><span class="n">emsec</span><span class="p">,</span><span class="n">DC</span><span class="o">=</span><span class="n">htb</span> <span class="o">-</span> <span class="n">STATUS</span><span class="p">:</span> <span class="n">Read</span> <span class="o">-</span> <span class="n">READ</span> <span class="n">TIME</span><span class="p">:</span> <span class="mi">2024</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">14</span><span class="n">T17</span><span class="p">:</span><span class="mi">10</span><span class="p">:</span><span class="mf">13.714765</span>
<span class="p">,</span> <span class="n">DN</span><span class="p">:</span> <span class="n">CN</span><span class="o">=</span><span class="n">Performance</span> <span class="n">Monitor</span> <span class="n">Users</span><span class="p">,</span><span class="n">CN</span><span class="o">=</span><span class="n">Builtin</span><span class="p">,</span><span class="n">DC</span><span class="o">=</span><span class="n">emsec</span><span class="p">,</span><span class="n">DC</span><span class="o">=</span><span class="n">htb</span> <span class="o">-</span> <span class="n">STATUS</span><span class="p">:</span> <span class="n">Read</span> <span class="o">-</span> <span class="n">READ</span> <span class="n">TIME</span><span class="p">:</span> <span class="mi">2024</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">14</span><span class="n">T17</span><span class="p">:</span><span class="mi">10</span><span class="p">:</span><span class="mf">13.714820</span>
<span class="p">,</span> <span class="n">DN</span><span class="p">:</span> <span class="n">CN</span><span class="o">=</span><span class="n">Performance</span> <span class="n">Log</span> <span class="n">Users</span><span class="p">,</span><span class="n">CN</span><span class="o">=</span><span class="n">Builtin</span><span class="p">,</span><span class="n">DC</span><span class="o">=</span><span class="n">emsec</span><span class="p">,</span><span class="n">DC</span><span class="o">=</span><span class="n">htb</span> <span class="o">-</span> <span class="n">STATUS</span><span class="p">:</span> <span class="n">Read</span> <span class="o">-</span> <span class="n">READ</span> <span class="n">TIME</span><span class="p">:</span> <span class="mi">2024</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">14</span><span class="n">T17</span><span class="p">:</span><span class="mi">10</span><span class="p">:</span><span class="mf">13.714872</span>
<span class="p">,</span> <span class="n">DN</span><span class="p">:</span> <span class="n">CN</span><span class="o">=</span><span class="n">Distributed</span> <span class="n">COM</span> <span class="n">Users</span><span class="p">,</span><span class="n">CN</span><span class="o">=</span><span class="n">Builtin</span><span class="p">,</span><span class="n">DC</span><span class="o">=</span><span class="n">emsec</span><span class="p">,</span><span class="n">DC</span><span class="o">=</span><span class="n">htb</span> <span class="o">-</span> <span class="n">STATUS</span><span class="p">:</span> <span class="n">Read</span> <span class="o">-</span> <span class="n">READ</span> <span class="n">TIME</span><span class="p">:</span> <span class="mi">2024</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">14</span><span class="n">T17</span><span class="p">:</span><span class="mi">10</span><span class="p">:</span><span class="mf">13.714922</span>
<span class="p">,</span> <span class="n">DN</span><span class="p">:</span> <span class="n">CN</span><span class="o">=</span><span class="n">IIS_IUSRS</span><span class="p">,</span><span class="n">CN</span><span class="o">=</span><span class="n">Builtin</span><span class="p">,</span><span class="n">DC</span><span class="o">=</span><span class="n">emsec</span><span class="p">,</span><span class="n">DC</span><span class="o">=</span><span class="n">htb</span> <span class="o">-</span> <span class="n">STATUS</span><span class="p">:</span> <span class="n">Read</span> <span class="o">-</span> <span class="n">READ</span> <span class="n">TIME</span><span class="p">:</span> <span class="mi">2024</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">14</span><span class="n">T17</span><span class="p">:</span><span class="mi">10</span><span class="p">:</span><span class="mf">13.714971</span>
<span class="p">,</span> <span class="n">DN</span><span class="p">:</span> <span class="n">CN</span><span class="o">=</span><span class="n">Cryptographic</span> <span class="n">Operators</span><span class="p">,</span><span class="n">CN</span><span class="o">=</span><span class="n">Builtin</span><span class="p">,</span><span class="n">DC</span><span class="o">=</span><span class="n">emsec</span><span class="p">,</span><span class="n">DC</span><span class="o">=</span><span class="n">htb</span> <span class="o">-</span> <span class="n">STATUS</span><span class="p">:</span> <span class="n">Read</span> <span class="o">-</span> <span class="n">READ</span> <span class="n">TIME</span><span class="p">:</span> <span class="mi">2024</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">14</span><span class="n">T17</span><span class="p">:</span><span class="mi">10</span><span class="p">:</span><span class="mf">13.715019</span>
<span class="p">,</span> <span class="n">DN</span><span class="p">:</span> <span class="n">CN</span><span class="o">=</span><span class="n">Event</span> <span class="n">Log</span> <span class="n">Readers</span><span class="p">,</span><span class="n">CN</span><span class="o">=</span><span class="n">Builtin</span><span class="p">,</span><span class="n">DC</span><span class="o">=</span><span class="n">emsec</span><span class="p">,</span><span class="n">DC</span><span class="o">=</span><span class="n">htb</span> <span class="o">-</span> <span class="n">STATUS</span><span class="p">:</span> <span class="n">Read</span> <span class="o">-</span> <span class="n">READ</span> <span class="n">TIME</span><span class="p">:</span> <span class="mi">2024</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">14</span><span class="n">T17</span><span class="p">:</span><span class="mi">10</span><span class="p">:</span><span class="mf">13.715107</span>
<span class="p">,</span> <span class="n">DN</span><span class="p">:</span> <span class="n">CN</span><span class="o">=</span><span class="n">Certificate</span> <span class="n">Service</span> <span class="n">DCOM</span> <span class="n">Access</span><span class="p">,</span><span class="n">CN</span><span class="o">=</span><span class="n">Builtin</span><span class="p">,</span><span class="n">DC</span><span class="o">=</span><span class="n">emsec</span><span class="p">,</span><span class="n">DC</span><span class="o">=</span><span class="n">htb</span> <span class="o">-</span> <span class="n">STATUS</span><span class="p">:</span> <span class="n">Read</span> <span class="o">-</span> <span class="n">READ</span> <span class="n">TIME</span><span class="p">:</span> <span class="mi">2024</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">14</span><span class="n">T17</span><span class="p">:</span><span class="mi">10</span><span class="p">:</span><span class="mf">13.715157</span>
<span class="p">,</span> <span class="n">DN</span><span class="p">:</span> <span class="n">CN</span><span class="o">=</span><span class="n">RDS</span> <span class="n">Remote</span> <span class="n">Access</span> <span class="n">Servers</span><span class="p">,</span><span class="n">CN</span><span class="o">=</span><span class="n">Builtin</span><span class="p">,</span><span class="n">DC</span><span class="o">=</span><span class="n">emsec</span><span class="p">,</span><span class="n">DC</span><span class="o">=</span><span class="n">htb</span> <span class="o">-</span> <span class="n">STATUS</span><span class="p">:</span> <span class="n">Read</span> <span class="o">-</span> <span class="n">READ</span> <span class="n">TIME</span><span class="p">:</span> <span class="mi">2024</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">14</span><span class="n">T17</span><span class="p">:</span><span class="mi">10</span><span class="p">:</span><span class="mf">13.715203</span>
</pre></table></code></div></div><p>You can dump every object using various filters.</p><p><a href="https://jonlabelle.com/snippets/view/markdown/ldap-search-filter-cheatsheet">LDAP Search Filter Cheatsheet</a></p><h2 id="adding-users-and-groups-"><span class="mr-2">Adding Users and Groups :</span><a href="#adding-users-and-groups-" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>To <code class="language-plaintext highlighter-rouge">add</code> or <code class="language-plaintext highlighter-rouge">modify</code> Users, groups or Organizational Unit one must have administrator privileges or the necessary permissions. I have already granted <code class="language-plaintext highlighter-rouge">user4</code> the permission to add users and groups.</p><p>To clarify the permissions granted to <code class="language-plaintext highlighter-rouge">user4</code>, I have given them full control over the <code class="language-plaintext highlighter-rouge">LDAP3_OU</code>:</p><p><a href="/assets/img/favicons/HackTheBox/ADDC-LDAP3/./user4_permission.png" class="popup img-link "><img data-src="/assets/img/favicons/HackTheBox/ADDC-LDAP3/./user4_permission.png" alt="user4 permission" class="lazyload" data-proofer-ignore></a></p><h3 id="add-new-user-to-organizational-unit-"><span class="mr-2">Add new user to organizational unit :</span><a href="#add-new-user-to-organizational-unit-" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>To search for all OU’s that it in the domain we use this filter :</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="o">&gt;&gt;&gt;</span>conn.search<span class="o">(</span><span class="s1">'dc=emsec,dc=htb'</span>,<span class="s1">'(objectclass=organizationalUnit)'</span><span class="o">)</span>
True
<span class="o">&gt;&gt;&gt;</span> conn.entries
<span class="o">[</span>DN: <span class="nv">OU</span><span class="o">=</span>Domain Controllers,DC<span class="o">=</span>emsec,DC<span class="o">=</span>htb - STATUS: Read - READ TIME: 2024-01-14T20:36:46.101068
, DN: <span class="nv">OU</span><span class="o">=</span>XXX,DC<span class="o">=</span>emsec,DC<span class="o">=</span>htb - STATUS: Read - READ TIME: 2024-01-14T20:36:46.101115
, DN: <span class="nv">OU</span><span class="o">=</span>XXX,DC<span class="o">=</span>emsec,DC<span class="o">=</span>htb - STATUS: Read - READ TIME: 2024-01-14T20:36:46.101142
, DN: <span class="nv">OU</span><span class="o">=</span>LDAP3_OU,DC<span class="o">=</span>emsec,DC<span class="o">=</span>htb - STATUS: Read - READ TIME: 2024-01-14T20:36:46.101167
<span class="o">]</span>
</pre></table></code></div></div><p>Now Let’s try to add users to LDAP3_OU</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="n">ldap3</span> <span class="kn">import</span> <span class="n">Server</span><span class="p">,</span><span class="n">Connection</span><span class="p">,</span><span class="n">ALL</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">server</span> <span class="o">=</span> <span class="nc">Server</span><span class="p">(</span><span class="sh">'</span><span class="s">emsec.emsec.htb</span><span class="sh">'</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">conn</span> <span class="o">=</span> <span class="nc">Connection</span><span class="p">(</span><span class="n">server</span><span class="p">,</span><span class="sh">'</span><span class="s">user4</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">Password@123!</span><span class="sh">'</span><span class="p">,</span><span class="n">auto_bind</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">conn</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="sh">'</span><span class="s">cn=Test_user,ou=LDAP3_OU,dc=emsec,dc=htb</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">user</span><span class="sh">'</span><span class="p">,</span> <span class="p">{</span><span class="sh">'</span><span class="s">givenName</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">TestName</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">sn</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">Test</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">departmentNumber</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">Test</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">telephoneNumber</span><span class="sh">'</span><span class="p">:</span> <span class="mi">1111</span><span class="p">})</span>
<span class="bp">True</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">conn</span><span class="p">.</span><span class="n">result</span>
<span class="p">{</span><span class="sh">'</span><span class="s">result</span><span class="sh">'</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="sh">'</span><span class="s">description</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">success</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">dn</span><span class="sh">'</span><span class="p">:</span> <span class="sh">''</span><span class="p">,</span> <span class="sh">'</span><span class="s">message</span><span class="sh">'</span><span class="p">:</span> <span class="sh">''</span><span class="p">,</span> <span class="sh">'</span><span class="s">referrals</span><span class="sh">'</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span> <span class="sh">'</span><span class="s">type</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">addResponse</span><span class="sh">'</span><span class="p">}</span>
<span class="o">&gt;&gt;&gt;</span>
</pre></table></code></div></div><p>As you can see, we have successfully added ‘Test_user’ to the ‘LDAP3_OU’ Organizational Unit. This occurred because we have full control permission over the OU.</p><p><a href="/assets/img/favicons/HackTheBox/ADDC-LDAP3/./add_user_to_ou.png" class="popup img-link "><img data-src="/assets/img/favicons/HackTheBox/ADDC-LDAP3/./add_user_to_ou.png" alt="add user to ou" class="lazyload" data-proofer-ignore></a></p><p><strong><em>Note:When creating a user, you can specify additional attributes such as description, mail, and more. We will explore this further in the modify entry section</em></strong></p><h3 id="add-group-to-organizational-unit-"><span class="mr-2">Add group to organizational unit :</span><a href="#add-group-to-organizational-unit-" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>As we saw earlier, to convert an entry from a user to a group, we simply need to change the <code class="language-plaintext highlighter-rouge">objectClass</code> attribute from <code class="language-plaintext highlighter-rouge">user</code> to <code class="language-plaintext highlighter-rouge">group</code></p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="o">&gt;&gt;&gt;</span> <span class="n">conn</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="sh">'</span><span class="s">cn=Test_Group,ou=LDAP3_OU,dc=emsec,dc=htb</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">group</span><span class="sh">'</span><span class="p">,</span> <span class="p">{</span><span class="sh">'</span><span class="s">cn</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">Test_Group</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">description</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">Test Group</span><span class="sh">'</span><span class="p">})</span>
<span class="bp">True</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">conn</span><span class="p">.</span><span class="n">result</span>
<span class="p">{</span><span class="sh">'</span><span class="s">result</span><span class="sh">'</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="sh">'</span><span class="s">description</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">success</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">dn</span><span class="sh">'</span><span class="p">:</span> <span class="sh">''</span><span class="p">,</span> <span class="sh">'</span><span class="s">message</span><span class="sh">'</span><span class="p">:</span> <span class="sh">''</span><span class="p">,</span> <span class="sh">'</span><span class="s">referrals</span><span class="sh">'</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span> <span class="sh">'</span><span class="s">type</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">addResponse</span><span class="sh">'</span><span class="p">}</span>
<span class="o">&gt;&gt;&gt;</span> 
</pre></table></code></div></div><p><a href="/assets/img/favicons/HackTheBox/ADDC-LDAP3/./add_group_to_ou.png" class="popup img-link "><img data-src="/assets/img/favicons/HackTheBox/ADDC-LDAP3/./add_group_to_ou.png" alt="add user to ou" class="lazyload" data-proofer-ignore></a></p><h3 id="add-user-to-group-"><span class="mr-2">Add user to group :</span><a href="#add-user-to-group-" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>As an administrator, I have granted user4 permission to add users to the <code class="language-plaintext highlighter-rouge">Test_Group</code>. This means we can accomplish this task using only user4.</p><h2 id="renamemodifyupdate-an-entry-"><span class="mr-2">Rename,Modify,Update an entry :</span><a href="#renamemodifyupdate-an-entry-" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Make sure to import the necessary namespaces MODIFY_ADD, MODIFY_REPLACE, and MODIFY_DELETE. With these imported, you can then modify, rename, and update an entry as needed.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="n">ldap3</span> <span class="kn">import</span> <span class="n">MODIFY_ADD</span><span class="p">,</span> <span class="n">MODIFY_REPLACE</span><span class="p">,</span> <span class="n">MODIFY_DELETE</span>
</pre></table></code></div></div><h3 id="rename-an-entry-"><span class="mr-2">Rename an entry :</span><a href="#rename-an-entry-" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Renaming an entry in LDAP means changing its <code class="language-plaintext highlighter-rouge">RDN (Relative Distinguished Name)</code></p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="o">&gt;&gt;&gt;</span> <span class="n">conn</span><span class="p">.</span><span class="nf">modify_dn</span><span class="p">(</span><span class="sh">'</span><span class="s">cn=Test_user,ou=LDAP3_OU,dc=emsec,dc=htb</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">cn=Renamed_User</span><span class="sh">'</span><span class="p">)</span>
<span class="bp">True</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">conn</span><span class="p">.</span><span class="n">result</span>
<span class="p">{</span><span class="sh">'</span><span class="s">result</span><span class="sh">'</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="sh">'</span><span class="s">description</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">success</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">dn</span><span class="sh">'</span><span class="p">:</span> <span class="sh">''</span><span class="p">,</span> <span class="sh">'</span><span class="s">message</span><span class="sh">'</span><span class="p">:</span> <span class="sh">''</span><span class="p">,</span> <span class="sh">'</span><span class="s">referrals</span><span class="sh">'</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span> <span class="sh">'</span><span class="s">type</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">modDNResponse</span><span class="sh">'</span><span class="p">}</span>
<span class="o">&gt;&gt;&gt;</span>
</pre></table></code></div></div><p><a href="/assets/img/favicons/HackTheBox/ADDC-LDAP3/./rename_user.png" class="popup img-link "><img data-src="/assets/img/favicons/HackTheBox/ADDC-LDAP3/./rename_user.png" alt="rename user" class="lazyload" data-proofer-ignore></a></p><h3 id="update-an-entry-"><span class="mr-2">Update an entry :</span><a href="#update-an-entry-" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>In this section, we will change attributes such as mail, description, and more. To do this, make sure to import the necessary namespaces <code class="language-plaintext highlighter-rouge">MODIFY_ADD</code>, <code class="language-plaintext highlighter-rouge">MODIFY_REPLACE</code>, and <code class="language-plaintext highlighter-rouge">MODIFY_DELETE</code>, as mentioned previously. Now, let’s proceed to update the attributes of our user <code class="language-plaintext highlighter-rouge">Renamed_user</code>.”</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="o">&gt;&gt;&gt;</span> <span class="n">conn</span><span class="p">.</span><span class="nf">modify</span><span class="p">(</span><span class="sh">'</span><span class="s">cn=Renamed_User,ou=LDAP3_OU,dc=emsec,dc=htb</span><span class="sh">'</span><span class="p">,</span> <span class="p">{</span><span class="sh">'</span><span class="s">sn</span><span class="sh">'</span><span class="p">:</span> <span class="p">[(</span><span class="n">MODIFY_REPLACE</span><span class="p">,</span> <span class="p">[</span><span class="sh">'</span><span class="s">New_Value</span><span class="sh">'</span><span class="p">])]})</span>
<span class="bp">True</span>
</pre></table></code></div></div><p><a href="/assets/img/favicons/HackTheBox/ADDC-LDAP3/./update_user_attributes.png" class="popup img-link "><img data-src="/assets/img/favicons/HackTheBox/ADDC-LDAP3/./update_user_attributes.png" alt="" class="lazyload" data-proofer-ignore></a></p><p>To delete the updated value :</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="o">&gt;&gt;&gt;</span> <span class="n">conn</span><span class="p">.</span><span class="nf">modify</span><span class="p">(</span><span class="sh">'</span><span class="s">cn=Renamed_User,ou=LDAP3_OU,dc=emsec,dc=htb</span><span class="sh">'</span><span class="p">,</span> <span class="p">{</span><span class="sh">'</span><span class="s">sn</span><span class="sh">'</span><span class="p">:</span> <span class="p">[(</span><span class="n">MODIFY_DELETE</span><span class="p">,</span> <span class="p">[</span><span class="sh">'</span><span class="s">New_Value</span><span class="sh">'</span><span class="p">])]})</span>
<span class="bp">True</span>
</pre></table></code></div></div><p><a href="/assets/img/favicons/HackTheBox/ADDC-LDAP3/./delete_atributes_users.png" class="popup img-link "><img data-src="/assets/img/favicons/HackTheBox/ADDC-LDAP3/./delete_atributes_users.png" alt="" class="lazyload" data-proofer-ignore></a></p><p>We have successfully deleted the <code class="language-plaintext highlighter-rouge">sn</code> attribute of our user</p><h2 id="building-my-tool-nexusad-"><span class="mr-2">Building my Tool NexusAD :</span><a href="#building-my-tool-nexusad-" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>The NexusAD tool, available on GitHub, is designed to simplify Active Directory management tasks. While the tool covers a range of functionalities, I want to emphasize that it’s created solely for fun and learning. In this blog post, I’ll share some screenshots of the tool in action. The code is open for exploration and modification. Feel free to upgrade and customize the tool based on your needs. Let’s run the tool and have some fun with Active Directory management!</p><p>You can find the complete source code on <a href="https://github.com/Mostafatoumi/nexusAd/blob/main/nexusAD.py">nexusAD.py</a></p><h3 id="how-to-use-this-simple-tool-"><span class="mr-2">How to use this simple tool ?</span><a href="#how-to-use-this-simple-tool-" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Simply run the command <code class="language-plaintext highlighter-rouge">python3 nexusAD.py -h</code> to see the available functionalities of this tool :</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre><td class="rouge-code"><pre>┌──<span class="o">(</span>root㉿emsec<span class="o">)</span>-[/opt/nexusAd]
└─# python3 nexusAD.py <span class="nt">-h</span>
usage: nexusAD.py <span class="o">[</span><span class="nt">-h</span><span class="o">]</span> <span class="nt">-domain</span> DOMAIN <span class="nt">-u</span> USERNAME <span class="nt">-p</span> PASSWORD <span class="nt">-dc</span> DOMAIN_CONTROLLER <span class="nt">-sf</span> SEARCH_FILTER <span class="o">[</span><span class="nt">-add-user</span> ADD_USER] <span class="o">[</span><span class="nt">-add-group</span> ADD_GROUP] <span class="o">[</span><span class="nt">-add-ou</span> ADD_OU]
                  <span class="o">[</span><span class="nt">-modify-object</span> MODIFY_OBJECT] <span class="o">[</span><span class="nt">-delete-object</span> DELETE_OBJECT]

LDAP Tool

options:
  <span class="nt">-h</span>, <span class="nt">--help</span>            show this <span class="nb">help </span>message and <span class="nb">exit</span>
  <span class="nt">-domain</span> DOMAIN        Domain name, e.g., example.com
  <span class="nt">-u</span> USERNAME, <span class="nt">--username</span> USERNAME
                        Username
  <span class="nt">-p</span> PASSWORD, <span class="nt">--password</span> PASSWORD
                        Password
  <span class="nt">-dc</span> DOMAIN_CONTROLLER, <span class="nt">--domain-controller</span> DOMAIN_CONTROLLER
                        Domain Controller IP
  <span class="nt">-sf</span> SEARCH_FILTER, <span class="nt">--search-filter</span> SEARCH_FILTER
                        Specify the LDAP search filter. For example, <span class="s1">'(&amp;(objectClass=user)(sAMAccountName=jdoe))'</span><span class="nb">.</span>
  <span class="nt">-add-user</span> ADD_USER    Add a new user
  <span class="nt">-add-group</span> ADD_GROUP  Add a new group
  <span class="nt">-add-ou</span> ADD_OU        Add a new Organizational Unit <span class="o">(</span>OU<span class="o">)</span>
  <span class="nt">-modify-object</span> MODIFY_OBJECT
                        Modify an LDAP object
  <span class="nt">-delete-object</span> DELETE_OBJECT
                        Delete an object, e.g., <span class="nv">CN</span><span class="o">=</span>emsec,CN<span class="o">=</span><span class="nb">users</span>,DC<span class="o">=</span>example,DC<span class="o">=</span>com

</pre></table></code></div></div><p><strong><em>Note: The <code class="language-plaintext highlighter-rouge">-modify-object</code> option is not currently functional. Consider it a next step to implement this feature in your tool. As mentioned before, this tool was created just for fun and learning purposes.</em></strong></p><h3 id="tool-options-"><span class="mr-2">Tool Options :</span><a href="#tool-options-" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>add user :</ul><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>┌──<span class="o">(</span>root㉿emsec<span class="o">)</span>-[/opt/nexusAd]
└─# python3 nexusAD.py <span class="nt">-domain</span> emsec.htb <span class="nt">-u</span> admin <span class="nt">-p</span> Password@123! <span class="nt">-dc</span> 10.10.10.10 <span class="nt">-add-user</span> fun_user
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Successfully connected to LDAP server at ldap://10.10.10.10

<span class="o">[</span>+] User fun_user added successfully.

User Path : <span class="nv">cn</span><span class="o">=</span>fun_user,cn<span class="o">=</span><span class="nb">users</span>,dc<span class="o">=</span>emsec,dc<span class="o">=</span>htb
</pre></table></code></div></div><ul><li>add group :</ul><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>┌──<span class="o">(</span>root㉿emsec<span class="o">)</span>-[/opt/nexusAd]
└─# python3 nexusAD.py <span class="nt">-domain</span> emsec.htb <span class="nt">-u</span> admin <span class="nt">-p</span> Password@123! <span class="nt">-dc</span> 10.10.10.10  <span class="nt">-add-group</span> fun_group
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Successfully connected to LDAP server at ldap://10.10.10.10

<span class="o">[</span>+] Group fun_group added successfully.

User Path : <span class="nv">cn</span><span class="o">=</span>fun_group,cn<span class="o">=</span><span class="nb">users</span>,dc<span class="o">=</span>emsec,dc<span class="o">=</span>htb
</pre></table></code></div></div><ul><li>add organizational unit :</ul><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre>┌──<span class="o">(</span>root㉿emsec<span class="o">)</span>-[/opt/nexusAd]
└─# python3 nexusAD.py <span class="nt">-domain</span> emsec.htb <span class="nt">-u</span> admin <span class="nt">-p</span> Password@123! <span class="nt">-dc</span> 10.10.10.10  <span class="nt">-add-ou</span> fun_ou
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Successfully connected to LDAP server at ldap://10.10.10.10

<span class="nv">ou</span><span class="o">=</span>fun_ou,dc<span class="o">=</span>emsec,dc<span class="o">=</span>htb
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Creatr OU :

<span class="o">[</span>+] Ou fun_ou added successfully.

Ou Path : <span class="nv">ou</span><span class="o">=</span>fun_ou,dc<span class="o">=</span>emsec,dc<span class="o">=</span>htb
</pre></table></code></div></div><ul><li>dump all users :</ul><p>You use this <a href="https://jonlabelle.com/snippets/view/markdown/ldap-search-filter-cheatsheet">LDAP Search Filter Cheatsheet </a></p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre><td class="rouge-code"><pre>┌──<span class="o">(</span>root㉿emsec<span class="o">)</span>-[/opt/nexusAd]
└─# python3 nexusAD.py <span class="nt">-domain</span> emsec.htb <span class="nt">-u</span> admin <span class="nt">-p</span> Password@123! <span class="nt">-dc</span> 10.10.10.10 <span class="nt">-sf</span> <span class="s1">'(objectclass=person)'</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Successfully connected to LDAP server at ldap://10.10.10.10

<span class="o">[</span><span class="k">*</span><span class="o">]</span> Search results <span class="k">for </span>filter <span class="s1">'(objectclass=person)'</span>: 

<span class="o">[</span><span class="k">*</span><span class="o">]</span> DN: <span class="nv">CN</span><span class="o">=</span>Administrator,CN<span class="o">=</span>Users,DC<span class="o">=</span>emsec,DC<span class="o">=</span>htb     
<span class="o">[</span><span class="k">*</span><span class="o">]</span> DN: <span class="nv">CN</span><span class="o">=</span>Guest,CN<span class="o">=</span>Users,DC<span class="o">=</span>emsec,DC<span class="o">=</span>htb
<span class="o">[</span><span class="k">*</span><span class="o">]</span> DN: <span class="nv">CN</span><span class="o">=</span>EMSEC,OU<span class="o">=</span>Domain Controllers,DC<span class="o">=</span>emsec,DC<span class="o">=</span>htb
<span class="o">[</span><span class="k">*</span><span class="o">]</span> DN: <span class="nv">CN</span><span class="o">=</span>krbtgt,CN<span class="o">=</span>Users,DC<span class="o">=</span>emsec,DC<span class="o">=</span>htb
<span class="o">[</span><span class="k">*</span><span class="o">]</span> DN: <span class="nv">CN</span><span class="o">=</span>Amanda Walker,CN<span class="o">=</span>Users,DC<span class="o">=</span>emsec,DC<span class="o">=</span>htb     
<span class="o">[</span><span class="k">*</span><span class="o">]</span> DN: <span class="nv">CN</span><span class="o">=</span>winrm_svc,CN<span class="o">=</span>Users,DC<span class="o">=</span>emsec,DC<span class="o">=</span>htb
<span class="o">[</span><span class="k">*</span><span class="o">]</span> DN: <span class="nv">CN</span><span class="o">=</span>user1,CN<span class="o">=</span>Users,DC<span class="o">=</span>emsec,DC<span class="o">=</span>htb
<span class="o">[</span><span class="k">*</span><span class="o">]</span> DN: <span class="nv">CN</span><span class="o">=</span>user2,CN<span class="o">=</span>Users,DC<span class="o">=</span>emsec,DC<span class="o">=</span>htb
<span class="o">[</span><span class="k">*</span><span class="o">]</span> DN: <span class="nv">CN</span><span class="o">=</span>user3,CN<span class="o">=</span>Users,DC<span class="o">=</span>emsec,DC<span class="o">=</span>htb
<span class="o">[</span><span class="k">*</span><span class="o">]</span> DN: <span class="nv">CN</span><span class="o">=</span>user4,CN<span class="o">=</span>Users,DC<span class="o">=</span>emsec,DC<span class="o">=</span>htb
<span class="o">[</span><span class="k">*</span><span class="o">]</span> DN: <span class="nv">CN</span><span class="o">=</span>Renamed_User,OU<span class="o">=</span>LDAP3_OU,DC<span class="o">=</span>emsec,DC<span class="o">=</span>htb
<span class="o">[</span><span class="k">*</span><span class="o">]</span> DN: <span class="nv">CN</span><span class="o">=</span>lol,OU<span class="o">=</span>LDAP3_OU,DC<span class="o">=</span>emsec,DC<span class="o">=</span>htb
<span class="o">[</span><span class="k">*</span><span class="o">]</span> DN: <span class="nv">CN</span><span class="o">=</span>user9,CN<span class="o">=</span>Users,DC<span class="o">=</span>emsec,DC<span class="o">=</span>htb
<span class="o">[</span><span class="k">*</span><span class="o">]</span> DN: <span class="nv">CN</span><span class="o">=</span>user10,CN<span class="o">=</span>Users,DC<span class="o">=</span>emsec,DC<span class="o">=</span>htb
<span class="o">[</span><span class="k">*</span><span class="o">]</span> DN: <span class="nv">CN</span><span class="o">=</span>admin,CN<span class="o">=</span>Users,DC<span class="o">=</span>emsec,DC<span class="o">=</span>htb
<span class="o">[</span><span class="k">*</span><span class="o">]</span> DN: <span class="nv">CN</span><span class="o">=</span>user11,CN<span class="o">=</span>Users,DC<span class="o">=</span>emsec,DC<span class="o">=</span>htb
<span class="o">[</span><span class="k">*</span><span class="o">]</span> DN: <span class="nv">CN</span><span class="o">=</span>fun_user,CN<span class="o">=</span>Users,DC<span class="o">=</span>emsec,DC<span class="o">=</span>htb
</pre></table></code></div></div><ul><li>dump all group :</ul><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre>┌──<span class="o">(</span>root㉿emsec<span class="o">)</span>-[/opt/nexusAd]
└─# python3 nexusAD.py <span class="nt">-domain</span> emsec.htb <span class="nt">-u</span> admin <span class="nt">-p</span> Password@123! <span class="nt">-dc</span> 10.10.10.10 <span class="nt">-sf</span> <span class="s1">'(objectclass=group)'</span> 
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Successfully connected to LDAP server at ldap://10.10.10.10

<span class="o">[</span><span class="k">*</span><span class="o">]</span> Search results <span class="k">for </span>filter <span class="s1">'(objectclass=group)'</span>:

<span class="o">[</span><span class="k">*</span><span class="o">]</span> DN: <span class="nv">CN</span><span class="o">=</span>Administrators,CN<span class="o">=</span>Builtin,DC<span class="o">=</span>emsec,DC<span class="o">=</span>htb
<span class="o">[</span><span class="k">*</span><span class="o">]</span> DN: <span class="nv">CN</span><span class="o">=</span>RAS and IAS Servers,CN<span class="o">=</span>Users,DC<span class="o">=</span>emsec,DC<span class="o">=</span>htb
<span class="o">[</span><span class="k">*</span><span class="o">]</span> DN: <span class="nv">CN</span><span class="o">=</span>Server Operators,CN<span class="o">=</span>Builtin,DC<span class="o">=</span>emsec,DC<span class="o">=</span>htb
<span class="o">[</span><span class="k">*</span><span class="o">]</span> DN: <span class="nv">CN</span><span class="o">=</span>Account Operators,CN<span class="o">=</span>Builtin,DC<span class="o">=</span>emsec,DC<span class="o">=</span>htb
<span class="o">[</span><span class="k">*</span><span class="o">]</span> DN: <span class="nv">CN</span><span class="o">=</span>Pre-Windows 2000 Compatible Access,CN<span class="o">=</span>Builtin,DC<span class="o">=</span>emsec,DC<span class="o">=</span>htb
<span class="o">[</span><span class="k">*</span><span class="o">]</span> DN: <span class="nv">CN</span><span class="o">=</span>Cloneable Domain Controllers,CN<span class="o">=</span>Users,DC<span class="o">=</span>emsec,DC<span class="o">=</span>htb
<span class="o">[</span><span class="k">*</span><span class="o">]</span> DN: <span class="nv">CN</span><span class="o">=</span>Protected Users,CN<span class="o">=</span>Users,DC<span class="o">=</span>emsec,DC<span class="o">=</span>htb
<span class="o">[</span><span class="k">*</span><span class="o">]</span> DN: <span class="nv">CN</span><span class="o">=</span>Key Admins,CN<span class="o">=</span>Users,DC<span class="o">=</span>emsec,DC<span class="o">=</span>htb
<span class="o">[</span><span class="k">*</span><span class="o">]</span> DN: <span class="nv">CN</span><span class="o">=</span>Enterprise Key Admins,CN<span class="o">=</span>Users,DC<span class="o">=</span>emsec,DC<span class="o">=</span>htb
<span class="o">[</span><span class="k">*</span><span class="o">]</span> DN: <span class="nv">CN</span><span class="o">=</span>DnsAdmins,CN<span class="o">=</span>Users,DC<span class="o">=</span>emsec,DC<span class="o">=</span>htb
<span class="o">[</span><span class="k">*</span><span class="o">]</span> DN: <span class="nv">CN</span><span class="o">=</span>DnsUpdateProxy,CN<span class="o">=</span>Users,DC<span class="o">=</span>emsec,DC<span class="o">=</span>htb
<span class="o">[</span><span class="k">*</span><span class="o">]</span> DN: <span class="nv">CN</span><span class="o">=</span>Test_Group,OU<span class="o">=</span>LDAP3_OU,DC<span class="o">=</span>emsec,DC<span class="o">=</span>htb
<span class="o">[</span><span class="k">*</span><span class="o">]</span> DN: <span class="nv">CN</span><span class="o">=</span>fun_group,CN<span class="o">=</span>Users,DC<span class="o">=</span>emsec,DC<span class="o">=</span>htb
</pre></table></code></div></div><ul><li>delete objects :</ul><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>┌──<span class="o">(</span>root㉿emsec<span class="o">)</span>-[/opt/nexusAd]
└─# python3 nexusAD.py <span class="nt">-domain</span> emsec.htb <span class="nt">-u</span> admin <span class="nt">-p</span> Password@123! <span class="nt">-dc</span> 10.10.10.10  <span class="nt">-delete-object</span> <span class="nv">CN</span><span class="o">=</span>fun_user,CN<span class="o">=</span>Users,DC<span class="o">=</span>emsec,DC<span class="o">=</span>htb
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Successfully connected to LDAP server at ldap://10.10.10.10

<span class="o">[</span>+] Object <span class="nv">CN</span><span class="o">=</span>fun_user,CN<span class="o">=</span>Users,DC<span class="o">=</span>emsec,DC<span class="o">=</span>htb deleted successfully.

</pre></table></code></div></div><h2 id="conclusion-"><span class="mr-2">Conclusion :</span><a href="#conclusion-" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>In conclusion, this blog has equipped you to navigate and manipulate Active Directory through Python and ldap3. By understanding the intricacies of LDAP, you’re ready to build custom tools and elevate your cybersecurity capabilities. Empower yourself to be a master of your tools and strategies in the realm of Active Directory security.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/notes/'>notes</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/active-directory/" class="post-tag no-text-decoration" >Active Directory</a> <a href="/tags/ldap3/" class="post-tag no-text-decoration" >ldap3</a> <a href="/tags/python3/" class="post-tag no-text-decoration" >python3</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=A%20Hands-On%20Guide%20to%20Active%20Directory%20Enumeration%20and%20Modification%20with%20ldap3%20-%20Mostafa%20Toumi&url=%2Fposts%2FLDAP3_ADDC%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=A%20Hands-On%20Guide%20to%20Active%20Directory%20Enumeration%20and%20Modification%20with%20ldap3%20-%20Mostafa%20Toumi&u=%2Fposts%2FLDAP3_ADDC%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=%2Fposts%2FLDAP3_ADDC%2F&text=A%20Hands-On%20Guide%20to%20Active%20Directory%20Enumeration%20and%20Modification%20with%20ldap3%20-%20Mostafa%20Toumi" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=%2Fposts%2FLDAP3_ADDC%2F" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <a href="http://service.weibo.com/share/share.php?title=A%20Hands-On%20Guide%20to%20Active%20Directory%20Enumeration%20and%20Modification%20with%20ldap3%20-%20Mostafa%20Toumi&url=%2Fposts%2FLDAP3_ADDC%2F" data-toggle="tooltip" data-placement="top" title="Weibo" target="_blank" rel="noopener" aria-label="Weibo"> <i class="fa-fw fab fa-weibo"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/LDAP/">LDAP Lightweight Directory Access Protocol</a><li><a href="/posts/HackTheBox-Sau/">HackTheBox-Sau Walkthrough</a><li><a href="/posts/DNS/">DNS Domain Name System</a><li><a href="/posts/ActiveDirectory_Management_with_Powershell/">Active Directory Management - A PowerShell Journey</a><li><a href="/posts/ADDC-LAB-PART_01/">Active Directory Mastery - A Guide to Windows Server Setup for Penetration Testing</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/active-directory/">Active Directory</a> <a class="post-tag" href="/tags/hackthebox/">HackTheBox</a> <a class="post-tag" href="/tags/python/">python</a> <a class="post-tag" href="/tags/dns/">DNS</a> <a class="post-tag" href="/tags/kerberos/">Kerberos</a> <a class="post-tag" href="/tags/ldap3/">ldap3</a> <a class="post-tag" href="/tags/ldap/">ldap</a> <a class="post-tag" href="/tags/ntlm/">NTLM</a> <a class="post-tag" href="/tags/powershell/">powershell</a> <a class="post-tag" href="/tags/python3/">python3</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc"></nav></div><script src="https://cdn.jsdelivr.net/npm/tocbot@4.20.1/dist/tocbot.min.js"></script></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4 mt-5"><div id="related-posts" class="mb-2 mb-sm-4"><h3 class="pt-2 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/ActiveDirectory_Management_with_Powershell/"><div class="card-body"> <em class="small" data-ts="1669204800" data-df="ll" > Nov 23, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Active Directory Management - A PowerShell Journey</h3><div class="text-muted small"><p> Mastering Active Directory: A PowerShell Odyssey Introduction to PowerShell and Active Directory PowerShell plays a crucial role in efficiently managing Active Directory, offering powerful cmdlet...</p></div></div></a></div><div class="card"> <a href="/posts/ADDC-LAB-PART_01/"><div class="card-body"> <em class="small" data-ts="1668945600" data-df="ll" > Nov 20, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Active Directory Mastery - A Guide to Windows Server Setup for Penetration Testing</h3><div class="text-muted small"><p> Setting Up a Windows Server for Penetration Testing with Active Directory 1. Introduction Overview of the blog&#39;s purpose : Welcome to the Active Directory Pentesting Blog, your ultimate guide fo...</p></div></div></a></div><div class="card"> <a href="/posts/DNS/"><div class="card-body"> <em class="small" data-ts="1669183200" data-df="ll" > Nov 23, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>DNS Domain Name System</h3><div class="text-muted small"><p> DNS : Introduction: DNS (Domain Name System) is a fundamental protocol used on the internet and local networks to translate human-readable domain names into numerical IP addresses. It plays a cruc...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/HackTheBox-Sau/" class="btn btn-outline-primary" prompt="Older"><p>HackTheBox-Sau Walkthrough</p></a><div class="btn btn-outline-primary disabled" prompt="Newer"><p>-</p></div></div></div></div></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/active-directory/">Active Directory</a> <a class="post-tag" href="/tags/hackthebox/">HackTheBox</a> <a class="post-tag" href="/tags/python/">python</a> <a class="post-tag" href="/tags/dns/">DNS</a> <a class="post-tag" href="/tags/kerberos/">Kerberos</a> <a class="post-tag" href="/tags/ldap3/">ldap3</a> <a class="post-tag" href="/tags/ldap/">ldap</a> <a class="post-tag" href="/tags/ntlm/">NTLM</a> <a class="post-tag" href="/tags/powershell/">powershell</a> <a class="post-tag" href="/tags/python3/">python3</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><footer><div class="container pl-lg-4 pr-lg-4"><div class="d-flex justify-content-between align-items-center text-muted ml-md-3 mr-md-3"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://twitter.com/EmSec0">Mostafa Toumi</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0">Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></div></footer><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lazysizes@5.3.2/lazysizes.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
